openapi: 3.0.3
info:
  title: TiMessengerTestDriver
  description: |
    ## REST interface to automate the test of a TI-Messenger client implementation.
    
    This API contains all endpoints for version 1.1.x and version 2 (TIM Pro & TIM ePA) of the TI-Messenger. The tags named accordingly can be used to find the endpoints applicable for the desired version.
    Additionally each endpoint summary will contain a note describing whether the endpoint is used by an org-admin, a client or both.
  version: 2.2.0
  contact:
    name: gematik GmbH
    email: software-development@gematik.de
    url: "https://www.gematik.de"
  license:
    name: Apache 2.0
    url: "https://www.apache.org/licenses/LICENSE-2.0"

externalDocs:
  description: TI-Messenger-API
  url: https://github.com/gematik/api-ti-messenger

servers:
  - url: '{protocol}://{host}:{port}/{api}'
    variables:
      protocol:
        enum:
          - http
          - https
        default: https
      host:
        default: 'localhost'
      port:
        default: '443'
      api:
        default: 'ti-messenger-testdriver'

tags:
  - name: info
    description: This operation returns meta data about this interface and the status of available resources
  - name: signalTestStart
    description: This endpoint serves the possibility to clean system before test
  - name: devices
    description: Operations for device management
  - name: account
    description: Account operations
  - name: login/logout
    description: login / logout an account
  - name: keyExchange
    description: export / import recoveryKey
  - name: orgAdminFhirOrganization
    description: OrgAdmin operations that could be operated on organizations in FHIR-VZD
  - name: orgAdminFhirHealthcareService
    description: OrgAdmin operations of HealthcareServices of an organization to FHIR-VZD
  - name: orgAdminFhirEndpoints
    description: OrgAdmin operations of Endpoints of an organization to FHIR-VZD
  - name: orgAdminFhirLocations
    description: OrgAdmin operations of Locations of an organization to FHIR-VZD
  - name: practitionerFhirAdministration
    description: Operations for practitioner to write to FHIR-VZD
  - name: searchOnHomeserver
    description: Search internally on homeserver
  - name: searchInFhirDirectory
    description: Search for Organization or Practitioner entries (VZD-FHIR-Directory)
  - name: message
    description: Message operations
  - name: room
    description: Room operations
  - name: contactManagement
    description: Contact management operations
  - name: media
    description: Media file upload and download
  - name: authorizationManagement
    description: Authorization management operations
  - name: TI-M_1.1.x
    description: All operations used in TI-Messenger Version 1.1.x
  - name: TI-M_Pro
    description: All operations used in TI-Messenger Pro
  - name: TI-M_ePA
    description: All operations used in TI-Messenger ePA

paths:
  /:
    parameters:
      - $ref: "#/components/parameters/transactionIdHeader"

    get:
      tags:
        - info
        - TI-M_1.1.x
        - TI-M_Pro
        - TI-M_ePA
      summary: "Returns the meta data of this interface. Used by Org-Admin and clients."
      operationId: getInfo
      responses:
        "200":
          description: "Metadata and capabilities of the software"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InfoObject"
        "403":
          $ref: "#/components/responses/Forbidden"
        default:
          $ref: "#/components/responses/DefaultResponse"

    post:
      tags:
        - signalTestStart
        - TI-M_1.1.x
        - TI-M_Pro
        - TI-M_ePA
      summary: "Indicates a test start, is used for clean up. Used by Org-Admin and clients."
      description: |
        Implementation is no longer optional! Testsuite sends a request to the involved test driver endpoints.
        The org-admins will also be triggered, if they are not declared in the feature-file, they will be retrieved based on the homeservers of the clients involved in the test case.
        There will be no claiming attempt before these endpoints are triggered.
        After getting *any* response the testcase starts.
        This is an opportunity to clean user/rooms/FHIR-VZD etc.
        Even if an error code is returned the testsuite will start the test.
      operationId: cleanUp
      responses:
        "200":
          description: "System clean"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices:
    parameters:
      - $ref: "#/components/parameters/transactionIdHeader"

    get:
      tags:
        - devices
        - TI-M_1.1.x
        - TI-M_Pro
        - TI-M_ePA
      summary: "Returns the connected devices and the information of the deposited HBA/SMC-B if existing. Used by Org-Admin and clients."
      operationId: getDevices
      responses:
        "200":
          description: "List of all devices for this test driver API"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Devices"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/claim:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"

    post:
      tags:
        - devices
        - TI-M_1.1.x
        - TI-M_Pro
        - TI-M_ePA
      summary: "Claims a device for exclusive use. Used by Org-Admin and clients."
      operationId: claimDevice
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ClaimDeviceRequest"
      responses:
        "200":
          description: "Device successfully claimed"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeviceInfo"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/unclaim:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"

    post:
      tags:
        - devices
        - TI-M_1.1.x
        - TI-M_Pro
        - TI-M_ePA
      summary: "Unclaims a previously claimed device. Used by Org-Admin and clients."
      operationId: unclaimDevice
      responses:
        "200":
          description: "Device successfully unclaimed"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeviceInfo"
        "400":
          $ref: "#/components/responses/BadRequest"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/account:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"

    get:
      tags:
        - account
        - TI-M_1.1.x
        - TI-M_Pro
        - TI-M_ePA
      summary: "Returns the account data or if no account is registered returns the authentication flows supported by the homeserver. Used by Org-Admin and clients."
      operationId: readAccount
      responses:
        "200":
          description: "account data of the logged in account"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Account"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/login:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"

    post:
      summary: "Login to an account. If no login data is provided, a preconfigured account should be used. In case the device has a HBA/SMC-B its data should be used. Used by Org-Admin and clients."
      tags:
        - login/logout
        - TI-M_1.1.x
        - TI-M_Pro
        - TI-M_ePA
      operationId: login
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Login"
      responses:
        "200":
          description: "Account data of the logged in account"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Account"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/logout:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"

    post:
      summary: "Logout of account. Used by Org-Admin and clients."
      tags:
        - login/logout
        - TI-M_1.1.x
        - TI-M_Pro
        - TI-M_ePA
      operationId: logout
      responses:
        "200":
          description: "Logout successful"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "403":
          $ref: "#/components/responses/Forbidden"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/logout/synced:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"

    post:
      summary: "Logout of an account with prolonged wait time. Used by clients."
      description: "This variant of the logout is used in tests, where it is important,
       that the logout is fully executed and synchronized before proceeding.
       The response must only be send, once the account is fully logged out."
      tags:
        - login/logout
        - TI-M_Pro
        - TI-M_ePA
      operationId: syncedLogout
      responses:
        "200":
          description: "Logout fully executed"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "403":
          $ref: "#/components/responses/Forbidden"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/account/key:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"

    get:
      tags:
        - keyExchange
        - TI-M_1.1.x
        - TI-M_Pro
        - TI-M_ePA
      summary: "Exports secret key for device synchronization. The key could be in any format but has to be understood by every provided test-driver-api per distributor! Used by clients."
      operationId: keyExport
      responses:
        "200":
          description: "Information about the exported key"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/matrixKeyInfo"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        default:
          $ref: "#/components/responses/DefaultResponse"

    post:
      tags:
        - keyExchange
        - TI-M_1.1.x
        - TI-M_Pro
        - TI-M_ePA
      summary: "Imports secret key and executes synchronization. Used by clients."
      operationId: keyImport
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/matrixKeyInfo"
      responses:
        "204":
          description: "Synchronization successful"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/fhir/org:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"
    get:
      tags:
        - orgAdminFhirOrganization
        - TI-M_1.1.x
        - TI-M_Pro
        - TI-M_ePA
      summary: "Get organization from the selected device. Used by Org-Admin."
      operationId: getOrganization
      responses:
        "200":
          description: "Data of the organization from the claimed client"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FhirOrganization"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/fhir/org/healthcareService:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"

    post:
      tags:
        - orgAdminFhirHealthcareService
        - TI-M_1.1.x
        - TI-M_Pro
      summary: "Creates new healthcare-service and returns the resource of the created healthcareService. Used by Org-Admin."
      operationId: createHealthcareService
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FhirHealthcareService"
      responses:
        "201":
          description: "Successfully created a new healthcare-service with the given data"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FhirHealthcareService"
        "400":
          $ref: "#/components/responses/BadRequest"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/fhir/org/healthcareService/{hsId}:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"
      - $ref: "#/components/parameters/healthcareServiceId"

    get:
      tags:
        - orgAdminFhirHealthcareService
        - TI-M_1.1.x
        - TI-M_Pro
      summary: "Get healthcareService for this id. Used by Org-Admin."
      operationId: getHealthcareService
      responses:
        "200":
          description: "Data of healthcareService associated with healthcareServiceId"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FhirHealthcareService"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

    put:
      tags:
        - orgAdminFhirHealthcareService
        - TI-M_1.1.x
        - TI-M_Pro
      summary: "Changes healthcareService accordingly. Used by Org-Admin."
      operationId: updateHealthcareService
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FhirHealthcareService"
      responses:
        "200":
          description: "Successfully updated healthcare service"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FhirHealthcareService"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

    delete:
      tags:
        - orgAdminFhirHealthcareService
        - TI-M_1.1.x
        - TI-M_Pro
      summary: "Delete healthcareService with this id. Used by Org-Admin."
      operationId: deleteHealthcareService
      responses:
        "204":
          description: "Successfully deleted healthcare service"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/fhir/org/healthcareService/{hsId}/endpoint:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"
      - $ref: "#/components/parameters/healthcareServiceId"

    get:
      tags:
        - orgAdminFhirEndpoints
        - TI-M_1.1.x
        - TI-M_Pro
      summary: "Get all endpoints for the healthcareService. Used by Org-Admin."
      description: "Get all endpoints for healthcare-service.
      (the search result could also contain all other resources that are related with it.
      Please ensure that the searched resources are included at any time!)"
      operationId: getEndpoints
      responses:
        "200":
          description: "Successfully got all endpoints for healthcare service"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FhirSearchResult"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

    post:
      tags:
        - orgAdminFhirEndpoints
        - TI-M_1.1.x
        - TI-M_Pro
      summary: "Create endpoint. Used by Org-Admin."
      operationId: createEndpoint
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FhirEndpoint"
      responses:
        "201":
          description: "Successfully created"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FhirEndpoint"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/fhir/org/healthcareService/{hsId}/endpoint/{endId}:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"
      - $ref: "#/components/parameters/healthcareServiceId"
      - $ref: "#/components/parameters/endpointId"

    get:
      summary: "Returns information about the requested endpoint. Used by Org-Admin."
      tags:
        - orgAdminFhirEndpoints
        - TI-M_1.1.x
        - TI-M_Pro
      operationId: getEndpoint
      responses:
        "200":
          description: "Successfully got endpoint"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FhirEndpoint"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

    put:
      tags:
        - orgAdminFhirEndpoints
        - TI-M_1.1.x
        - TI-M_Pro
      summary: "Updates an endpoint. Used by Org-Admin."
      operationId: updateEndpoint
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FhirEndpoint"
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FhirEndpoint"
          description: "Successfully updated endpoint"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

    delete:
      tags:
        - orgAdminFhirEndpoints
        - TI-M_1.1.x
        - TI-M_Pro
      summary: "Deletes an endpoint. Used by Org-Admin."
      operationId: deleteEndpoint
      responses:
        "204":
          description: "Successfully deleted endpoint"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/fhir/org/healthcareService/{hsId}/endpointVisibility/{endId}:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"
      - $ref: "#/components/parameters/healthcareServiceId"
      - $ref: "#/components/parameters/endpointId"

    post:
      tags:
        - orgAdminFhirEndpoints
        - TI-M_Pro
      summary: "Set the endpointVisibility of the endpoint of the healthcare service to hide-versichert. Used by Org-Admin."
      operationId: setEndpointVisibilityOfHealthcareService
      responses:
        "201":
          description: "endpointVisibility in FHIR-VZD was created as hide-versichert"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FhirEndpoint"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "501":
          description: "Unimplemented - if the underlying client does not support practitioner FHIR-VZD administration"
        default:
          $ref: "#/components/responses/DefaultResponse"

    delete:
      tags:
        - orgAdminFhirEndpoints
        - TI-M_Pro
      summary: "Remove the endpointVisibility of the endpoint of the healthcare service. Used by Org-Admin."
      operationId: removeEndpointVisibilityOfHealthcareService
      responses:
        "204":
          description: "Successfully deleted"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "501":
          description: "Unimplemented - if the underlying client does not support practitioner FHIR-VZD administration"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/fhir/endpointVisibility:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"

    post:
      tags:
        - practitionerFhirAdministration
        - TI-M_Pro
      summary: "Set the endpointVisibility in the own practitioner FHIR resource to hide-versichert. Used by clients."
      operationId: setEndpointVisibility
      responses:
        "201":
          description: "endpointVisibility in FHIR-VZD was created as hide-versichert"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FhirEndpoint"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "501":
          description: "Unimplemented - if the underlying client does not support practitioner FHIR-VZD administration"
        default:
          $ref: "#/components/responses/DefaultResponse"

    delete:
      tags:
        - practitionerFhirAdministration
        - TI-M_Pro
      summary: "Remove the endpointVisibility in the own Practitioner FHIR resource. Used by clients."
      operationId: removeEndpointVisibility
      responses:
        "204":
          description: "Successfully deleted"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "501":
          description: "Unimplemented - if the underlying client does not support practitioner FHIR-VZD administration"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/fhir/fhirAuthenticate:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"

    post:
      tags:
        - practitionerFhirAdministration
        - TI-M_1.1.x
        - TI-M_Pro
      summary: "This request starts the OIDC authentication for getting access to change the own FHIR entry. Used by clients."
      operationId: authenticateOnFhirDirectory
      responses:
        "200":
          description: "OIDC flow with IDP successfully completed"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "501":
          description: "Unimplemented - if the underlying client does not support FHIR-VZD authentication"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/fhir/mxidInFhirDirectory:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"

    post:
      tags:
        - practitionerFhirAdministration
        - TI-M_1.1.x
        - TI-M_Pro
      summary: "Set the MXID in the own practitioner FHIR resource and the created endpoint. Used by clients."
      operationId: setMxidInFhirDirectory
      responses:
        "201":
          description: "mxid entry in FHIR-VZD was created"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FhirEndpoint"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "501":
          description: "Unimplemented - if the underlying client does not support practitioner FHIR-VZD administration"
        default:
          $ref: "#/components/responses/DefaultResponse"

    get:
      tags:
        - practitionerFhirAdministration
        - TI-M_1.1.x
        - TI-M_Pro
      summary: "Returns the own practitioner entry with belonging resources from the FHIR Directory. Used by clients."
      operationId: readMxidInFhirDirectory
      responses:
        "200":
          description: "The own FHIR-Practitioner entry data"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FhirSearchResult"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "501":
          description: "Unimplemented - if the underlying client does not support practitioner FHIR-VZD administration"
        default:
          $ref: "#/components/responses/DefaultResponse"

    delete:
      tags:
        - practitionerFhirAdministration
        - TI-M_1.1.x
        - TI-M_Pro
      summary: "Remove the MXID in the own Practitioner FHIR resource. Used by clients."
      operationId: removeMxidInFhirDirectory
      responses:
        "204":
          description: "Successfully deleted"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "501":
          description: "Unimplemented - if the underlying client does not support practitioner FHIR-VZD administration"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/homeserver/search:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"

    get:
      tags:
        - searchOnHomeserver
        - TI-M_1.1.x
        - TI-M_Pro
      summary: "Returns a list of users on same homeserver that matches search parameters. Used by clients."
      operationId: searchOnHomeserver
      parameters:
        - name: displayName
          in: query
          description: "Display name of account"
          schema:
            type: string
        - name: mxId
          in: query
          description: "MxId of account"
          schema:
            type: string
            example: "@someone:gematik.de"

      responses:
        "200":
          description: "List of users for given parameters"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HomeserverSearchResultList"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/fhir/searchOrganizationInFhirDirectory:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"

    get:
      tags:
        - searchInFhirDirectory
        - TI-M_1.1.x
        - TI-M_Pro
        - TI-M_ePA
      summary: "Returns all belonging resources of an organization. Used by clients."
      operationId: searchOrganizationInFhirDirectory
      parameters:
        - name: healthcareServiceName
          in: query
          description: "Name of the healthcare service"
          schema:
            type: string
        - name: name
          in: query
          description: "Name of the Organization"
          schema:
            type: string
        - name: address
          in: query
          description: "Address of the Organization."
          schema:
            type: string
        - name: telematikId
          in: query
          description: "The telematikId of the Organization."
          schema:
            type: string
        - name: typeCode
          in: query
          description: "The type of the Organization (OrganizationTypeVS.Code)."
          schema:
            type: string
        - name: typeDisplay
          in: query
          description: "The type of the Organization (OrganizationTypeVS.Display)."
          schema:
            type: string
        - name: contactMxid
          in: query
          description: "MXID of the Organization.contact in uri scheme."
          schema:
            type: string
            example: matrix:u/someone:gematik.de
        - name: contactName
          in: query
          description: "Name of the Organization.contact."
          schema:
            type: string
        - name: contactPurpose
          in: query
          description: "Purpose of the Organization.contact."
          schema:
            type: string

      responses:
        "200":
          description: "Resources for given parameters"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FhirSearchResult"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/fhir/searchHealthcareServiceEndpointInFhirDirectory:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"

    get:
      tags:
        - searchInFhirDirectory
        - TI-M_1.1.x
        - TI-M_Pro
        - TI-M_ePA
      summary: "Returns the found endpoints of the healthcare services matching the query. Used by clients."
      description: "Returns the found endpoints of the healthcare services matching the query.
      (the search result could also contain all other resources that are related with it.
      Please ensure that the searched resources are included at any time!)"
      operationId: searchHsEndpointInFhirDirectory
      parameters:
        - name: name
          in: query
          description: "The name of the endpoint"
          schema:
            type: string
        - name: mxId
          in: query
          description: "MxId (in uri scheme) standing in address field of the endpoint"
          schema:
            type: string
            example: matrix:u/someone:gematik.de

      responses:
        "200":
          description: "Found endpoints and related resources for given parameters"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FhirSearchResult"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/fhir/searchPractitionerInFhirDirectory:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"

    get:
      tags:
        - searchInFhirDirectory
        - TI-M_1.1.x
        - TI-M_Pro
        - TI-M_ePA
      summary: "Returns the found Practitioner entries and its belonging location, endpoints and practitioner roles. Used by clients."
      operationId: searchPractitionerInFhirDirectory
      parameters:
        - name: name
          in: query
          description: "Name of the Practitioner"
          schema:
            type: string
        - name: address
          in: query
          description: "Address of the Practitioner."
          schema:
            type: string
        - name: telematikId
          in: query
          description: "The telematikId of the Practitioner."
          schema:
            type: string
        - name: typeCode
          in: query
          description: "The type of the Practitioner (PractitionerQualificationProfessionOidVS.Code)."
          schema:
            type: string
        - name: typeDisplay
          in: query
          description: "The type of the Practitioner (PractitionerQualificationProfessionOidVS.Display)."
          schema:
            type: string
        - name: mxid
          in: query
          description: "MXID of the Practitioner in uri scheme."
          schema:
            type: string
            example: matrix:u/someone:gematik.de

      responses:
        "200":
          description: "Practitioner entries for given parameters"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FhirSearchResult"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/sendMessage:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"

    post:
      tags:
        - message
        - TI-M_1.1.x
        - TI-M_Pro
        - TI-M_ePA
      summary: "Send a direct message. Used by clients."
      description: "Send a direct message to another user.
      Should work without creating a dedicated room first.
      The recipients MxId is received through a searchInFhirDirectory-Request."
      operationId: sendDirectMessage
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/DirectMessage"
      responses:
        "200":
          description: "The message was sent successfully to its recipient"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Message"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/rooms/{roomId}/messages:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"
      - $ref: "#/components/parameters/roomId"

    get:
      tags:
        - message
        - TI-M_1.1.x
        - TI-M_Pro
        - TI-M_ePA
      summary: "Lists messages in room. Used by clients."
      operationId: getMessages
      responses:
        "200":
          description: "Messages for this room"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Messages"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

    post:
      tags:
        - message
        - TI-M_1.1.x
        - TI-M_Pro
        - TI-M_ePA
      summary: "Sends a new message. Used by clients."
      operationId: sendMessage
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MessageContent"
      responses:
        "200":
          description: "Message sent"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Message"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/rooms/{roomId}/messages/{messageId}:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"
      - $ref: "#/components/parameters/roomId"
      - $ref: "#/components/parameters/messageId"

    get:
      summary: "Get single message. Used by clients."
      tags:
        - message
        - TI-M_1.1.x
        - TI-M_Pro
        - TI-M_ePA
      operationId: getMessage
      responses:
        "200":
          description: "Message information"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Message"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"
    put:
      summary: "Edit an existing message. Used by clients."
      tags:
        - message
        - TI-M_1.1.x
        - TI-M_Pro
        - TI-M_ePA
      operationId: editMessage
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MessageContent"
      responses:
        "200":
          description: "Successfully edited message"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Message"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

    delete:
      summary: "Deletes a message. Used by clients."
      tags:
        - message
        - TI-M_1.1.x
        - TI-M_Pro
        - TI-M_ePA
      operationId: deleteMessage
      responses:
        "204":
          description: "Message deleted"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/rooms:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"

    get:
      tags:
        - room
        - TI-M_1.1.x
        - TI-M_Pro
        - TI-M_ePA
      operationId: getRooms
      summary: "Get list of all rooms your account is associated with. Used by clients."
      responses:
        "200":
          description: "All associated rooms of the logged in account"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Rooms"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

    post:
      tags:
        - room
        - TI-M_1.1.x
        - TI-M_Pro
        - TI-M_ePA
      summary: "Create a room. Used by clients."
      operationId: createRoom
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateRoomRequest"
      responses:
        "201":
          description: "Room created"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Room"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/rooms/public:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"

    get:
      tags:
        - room
        - TI-M_1.1.x
        - TI-M_Pro
        - TI-M_ePA
      summary: "Get public rooms matching params. Used by clients."
      operationId: getPublicRooms
      parameters:
        - name: name
          in: query
          description: "Full- or partial name of the Room"
          schema:
            type: string

      responses:
        "200":
          description: "All associated public rooms of the logged in account"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Rooms"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/rooms/{roomId}:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"
      - $ref: "#/components/parameters/roomId"
    get:
      tags:
        - room
        - TI-M_1.1.x
        - TI-M_Pro
        - TI-M_ePA
      summary: "Get the room settings. Used by clients."
      operationId: getRoomSettings
      responses:
        "200":
          description: "Settings for the requested roomId"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Room"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

    delete:
      tags:
        - room
        - TI-M_1.1.x
        - TI-M_Pro
        - TI-M_ePA
      summary: "Forget this room. Used by clients."
      operationId: forgetRoom
      responses:
        "204":
          description: "Room forgotten"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/rooms/{roomId}/invite:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"
      - $ref: "#/components/parameters/roomId"

    post:
      tags:
        - room
        - TI-M_1.1.x
        - TI-M_Pro
        - TI-M_ePA
      summary: "Invite a user into the room. Used by clients."
      operationId: inviteIntoRoom
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RoomInvite"
      responses:
        "200":
          description: "Sent an invite to given user"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Room"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/rooms/{roomId}/join:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"
      - $ref: "#/components/parameters/roomId"

    post:
      tags:
        - room
        - TI-M_1.1.x
        - TI-M_Pro
        - TI-M_ePA
      summary: "Join the room. Used by clients."
      operationId: joinRoom
      responses:
        "200":
          description: "Room joined"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Room"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/rooms/{roomId}/leave:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"
      - $ref: "#/components/parameters/roomId"

    post:
      tags:
        - room
        - TI-M_1.1.x
        - TI-M_Pro
        - TI-M_ePA
      summary: "Leave the room. Used by clients."
      operationId: leaveRoom
      responses:
        "200":
          description: "Room left"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Room"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/rooms/{roomId}/state:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"
      - $ref: "#/components/parameters/roomId"

    get:
      tags:
        - room
        - TI-M_1.1.x
        - TI-M_Pro
        - TI-M_ePA
      summary: "Returns all state events of the room. Used by clients."
      operationId: getStateEvents
      responses:
        "200":
          description: "Get room state events"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RoomStates"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/contacts:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"

    get:
      tags:
        - contactManagement

      summary: "Returns the contacts with invite settings. Used by clients."
      operationId: getContacts
      responses:
        "200":
          description: "List of all contact settings of the user"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Contacts"
        default:
          $ref: "#/components/responses/DefaultResponse"

    post:
      tags:
        - contactManagement
        - TI-M_1.1.x

      summary: "Creates the setting for the contact. Used by clients."
      operationId: createContactSetting
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Contact"
      responses:
        "200":
          description: "Contact setting successfully created"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Contact"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

    put:
      tags:
        - contactManagement
        - TI-M_1.1.x

      summary: "Updates the setting for the contact. Used by clients."
      operationId: updateContactSetting
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Contact"
      responses:
        "200":
          description: "Contact setting successfully updated"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Contact"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/contacts/{mxid}:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"
      - $ref: "#/components/parameters/mxidInPath"

    delete:
      tags:
        - contactManagement
        - TI-M_1.1.x

      summary: "Deletes the setting for the contact {mxid}. Used by clients."
      operationId: deleteContactSetting
      responses:
        "204":
          description: Deleted
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/media:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"
    post:
      tags:
        - media
        - TI-M_1.1.x
        - TI-M_Pro
        - TI-M_ePA
      summary: "Uploads a file and returns its fileId. Used by clients."
      operationId: postMediaFile
      parameters:
        - in: header
          name: Content-Type
          required: true
          description: "Define type of the sent media. Should be in compliance with RFC6838"
          schema:
            type: string
      requestBody:
        required: true
        content:
          "*/*":
            schema:
              type: string
              format: binary
      responses:
        "201":
          description: "Upload successful"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MediaFileId"

  /devices/{deviceId}/media/{fileId}:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"
      - $ref: "#/components/parameters/fileId"
    get:
      tags:
        - media
        - TI-M_1.1.x
      summary: "Returns a previously uploaded file with given id. Used by clients."
      operationId: getMediaFile
      responses:
        "200":
          description: "Retrieved the media file"
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/media/authenticated/{fileId}:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"
      - $ref: "#/components/parameters/fileId"
    get:
      tags:
        - media
        - TI-M_Pro
        - TI-M_ePA
      summary: "Returns a previously uploaded file with authentication. Used by clients."
      description:
        "Since Matrix version 1.11 the download of media files is authenticated.
        This endpoint is used to test the new authenticated download,
        where fileId is the id received during upload."
      operationId: getAuthenticatedMediaFile
      responses:
        "200":
          description: "Retrieved the media file"
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/authorizationMode:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"
    get:
      tags:
        - authorizationManagement
        - TI-M_Pro
        - TI-M_ePA
      summary: "Returns the currently active authorization mode. Used by clients."
      operationId: getAuthorizationMode
      responses:
        "200":
          description: "Information about the client authorization mode"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthorizationMode"
        default:
          $ref: "#/components/responses/DefaultResponse"

    post:
      tags:
        - authorizationManagement
        - TI-M_Pro
        - TI-M_ePA
      summary: "Selects the authorization mode. Used by clients."
      operationId: setAuthorizationMode
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AuthorizationMode"
      responses:
        "200":
          description: "Client authorization mode was set"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthorizationMode"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/allowedUsers:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"
    get:
      tags:
        - authorizationManagement
        - TI-M_Pro
        - TI-M_ePA
      summary: "Returns a list of all mxids, server-names and groups, which are allowed to contact the client. Used by clients."
      operationId: getAllowedUsersList
      responses:
        "200":
          description: "List of allowed users"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthorizationList"
        "403":
          description: "Cannot get allowed users for mode AllowAll"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/DefaultResponse"

    post:
      tags:
        - authorizationManagement
        - TI-M_Pro
        - TI-M_ePA
      summary: "Adds the users in the provided list to the list of allowed users. Used by clients."
      operationId: addAllowedUsersList
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AuthorizationList"
      responses:
        "200":
          description: "Allowed users added"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthorizationList"
        "403":
          description: "Cannot add allowed users for mode AllowAll"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

    delete:
      tags:
        - authorizationManagement
        - TI-M_Pro
        - TI-M_ePA
      summary: "Deletes the provided users from the list of users allowed to contact the client. Used by clients."
      operationId: deleteAllowedUsersList
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AuthorizationList"
      responses:
        "204":
          description: "Allowed users deleted"
        "403":
          description: "Cannot delete allowed users for mode AllowAll"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

  /devices/{deviceId}/blockedUsers:
    parameters:
      - $ref: "#/components/parameters/deviceId"
      - $ref: "#/components/parameters/transactionIdHeader"
    get:
      tags:
        - authorizationManagement
        - TI-M_Pro
        - TI-M_ePA
      summary: "Returns a list of all users, which are not allowed to contact the client. Used by clients."
      operationId: getBlockedUsersList
      responses:
        "200":
          description: "List of blocked users and/or server-names"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthorizationList"
        "403":
          description: "Cannot get blocked users for mode BlockAll"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        default:
          $ref: "#/components/responses/DefaultResponse"

    post:
      tags:
        - authorizationManagement
        - TI-M_Pro
        - TI-M_ePA
      summary: "Adds the users in the provided list to the list of blocked users and server-names. Used by clients."
      operationId: addBlockedUsersList
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AuthorizationList"
      responses:
        "200":
          description: "Blocked users added"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthorizationList"
        "403":
          description: "Cannot add blocked users for mode BlockAll"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"

    delete:
      tags:
        - authorizationManagement
        - TI-M_Pro
        - TI-M_ePA
      summary: "Deletes the provided users from the list of users not allowed to contact the client. Used by clients."
      operationId: deleteBlockedUsersList
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AuthorizationList"
      responses:
        "204":
          description: "Blocked users list deleted"
        "403":
          description: "Cannot delete blocked users for mode BlockAll"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        default:
          $ref: "#/components/responses/DefaultResponse"


components:

  parameters:

    deviceId:
      name: deviceId
      in: path
      description: "ID of the device that will be used."
      required: true
      schema:
        type: integer
        format: int64
        example: 42

    roomId:
      name: roomId
      in: path
      description: "ID of the room"
      required: true
      schema:
        type: string
        example: room1

    messageId:
      name: messageId
      in: path
      description: "ID of the message"
      required: true
      schema:
        type: string
        example: msg-4711

    mxidInPath:
      name: mxid
      in: path
      description: "ID of the contact (mxid)."
      required: true
      schema:
        type: string
        example: "@you:example.org"

    serverNameInPath:
      name: serverName
      in: path
      description: "Server-Name: https://spec.matrix.org/v1.11/appendices/#server-name"
      required: true
      schema:
        type: string
        example: "matrix.org"

    healthcareServiceId:
      name: hsId
      in: path
      description: "ID of the healthcareService"
      required: true
      schema:
        type: string
        example: 1a62648f-55a7-42d5-ab7f-841e78be390e

    locationId:
      name: locId
      in: path
      description: "ID of the location"
      required: true
      schema:
        type: string
        example: c8632e61-b04d-4c3f-9818-ab9a641ef18a

    endpointId:
      name: endId
      in: path
      description: "ID of the endpoint"
      required: true
      schema:
        type: string
        example: 81add1c5-675b-4785-9405-a2e75b660b2e

    fileId:
      name: fileId
      in: path
      description: "ID of media file"
      required: true
      schema:
        type: string
        example: 81add1c5-675b-4785-9405-a2e75b660b2e

    transactionIdHeader:
      in: header
      name: Transaction-Id
      required: false
      description: Parameter to identify running transaction (name/id). Can be used for debugging purpose
      example: "@TCID:TIM_11_AF_401/e800424f-b37d-4fa9-969e-894ddc0b2362"
      schema:
        type: string

  responses:

    DefaultResponse:
      description: "The default error response"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
    NotFound:
      description: "The specified resource was not found"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
    InternalServerError:
      description: "Something went wrong server internally"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
    Unauthorized:
      description: "Unauthorized - you have to login first"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/AuthFlows"
    Forbidden:
      description: "Forbidden - you are not allowed to do this"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
    BadRequest:
      description: "Bad Request"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"

  schemas:

    Account:
      description: "General information of an account"
      readOnly: true
      type: object
      allOf:
        - $ref: "#/components/schemas/MxId"
      required:
        - username
        - password
        - displayName
      properties:
        accessToken:
          type: string
          description: "Access token for this user"
          example: "my_great_token_3vLflW"
        username:
          type: string
          description: "Username that can be used to login to this account"
          example: "ThomasMueller"
        password:
          type: string
          description: "Password that can be used to login to this account"
          example: "SafePassword123"
        displayName:
          type: string
          description: "The displayName"
          example: "some name"

    ApplicationType:
      description: "Enum of possible types of applications"
      type: string
      enum: [ Native, WebApp ]

    AuthFlow:
      description: "Authentication flow and its stages"
      type: object
      properties:
        stages:
          description: "Stages for this flow"
          type: array
          items:
            $ref: "#/components/schemas/AuthStageName"

    AuthFlows:
      description: "Information about available authentication flows and already completed stages"
      type: object
      properties:
        completedAuthStages:
          description: "Already completed stages"
          type: array
          items:
            $ref: "#/components/schemas/AuthStageName"
        flows:
          description: "Available authentication flows and their stages"
          type: array
          items:
            $ref: "#/components/schemas/AuthFlow"
        params:
          description: "Parameters for all the stages"
          type: object
          properties:
            basicAuth:
              $ref: "#/components/schemas/BasicAuthStage"

    AuthStageName:
      description: "A stage in an authentication flow"
      type: string
      enum: [ basicAuth ]
      example: basicAuth

    AuthorizationList:
      description: "The list of entries in authorization list"
      required:
        - mxids
        - serverNames
        - groupNames
      type: object
      properties:
        groupNames:
          description: "The list of groups"
          type: array
          items:
            $ref: "#/components/schemas/GroupName"
        mxids:
          description: "The list of mxids"
          type: array
          items:
            $ref: "#/components/schemas/MxId"
        serverNames:
          description: "The list of server-names"
          type: array
          items:
            $ref: "#/components/schemas/ServerName"

    AuthorizationMode:
      description: "Client authorization mode"
      type: string
      example: "AllowAll"
      enum: [ AllowAll, BlockAll ]

    BasicAuthStage:
      description: "AuthStage for username + password authentication"
      required:
        - username
        - password
      type: object
      properties:
        username:
          type: string
          description: "The username (localpart of the MXID)"
          example: "myUsername"
        password:
          type: string
          format: password
          description: "If authMethod is basicAuth, a password is required"
          example: "mySecretPassword"

    BrowserInfo:
      description: "Additional information about the used browser. Should only be filled if application type is 'WebApp'"
      properties:
        name:
          type: string
          description: "Name of the used browser"
          example: Firefox
        version:
          type: string
          description: "Version of the used Browser"
          example: 1.0.0

    ClaimDeviceRequest:
      required:
        - claimerName
        - claimFor
      type: object
      description: "Request for claiming a device"
      properties:
        claimerName:
          type: string
          description: "Name of the claimer"
          example: "some name"
        claimFor:
          type: integer
          description: "Duration in seconds this device should be exclusively claimed for. Resets after using device."
          minimum: 60
          example: 180

    ClientCapabilities:
      description: "Flags for implemented capabilities of the client"
      type: object
      properties:
        canAdministrateFhirOrganization:
          type: boolean
          description: "Whether this client can handle OrgAdmin-operations to administrate an organization in FHIR-VZD"
        canAdministrateFhirPractitioner:
          type: boolean
          description: "Whether this client can handle operations to administrate a practitioner entry in FHIR-VZD"
        canSendMessages:
          type: boolean
          description: "Whether this client has basic messaging capabilities"
        isInsurance:
          type: boolean
          description: "Whether this client runs the TI-Messenger version ePA"
        isPro:
          type: boolean
          description: "Whether this client runs the TI-Messenger version Pro"

    ClientSoftwareInfo:
      description: "General information about the client software"
      allOf:
        - $ref: "#/components/schemas/SoftwareInfo"
        - $ref: "#/components/schemas/ClientCapabilities"
      properties:
        browserInfo:
          $ref: "#/components/schemas/BrowserInfo"

    Contact:
      description: "Contact settings"
      type: object
      properties:
        mxid:
          type: string
          description: "ID of the contact (mxid)"
          example: "@someone:gematik.de"
        inviteSettings:
          type: object
          properties:
            start:
              type: integer
              minimum: 0
              format: int64
              description: "start (Epoch Unix Timestamp, SECONDS SINCE JAN 01 1970. (UTC))"
              example: 1654159585
            end:
              type: integer
              minimum: 0
              format: int64
              description: "end  (Epoch Unix Timestamp, SECONDS SINCE JAN 01 1970. (UTC))"
              example: 1654169585
          required:
            - start
          description: "Invites from the mxid are granted between start and end date-time"
      required:
        - mxid
        - inviteSettings

    ContactInfo:
      readOnly: true
      description: "Die Kontaktinformationen für diese Schnittstelle."
      type: object
      required:
        - name
      properties:
        name:
          type: string
          description: "Der Name von der Kontaktperson / -Organisation"
          example: "Firma 123"
        url:
          type: string
          format: uri
          description: "Eine URL zu den Kontaktinformationen für dieses API.
            In dem Dokument unter dieser URL muss ein Link zum Download der aktuell genutzten YAML Datei dieser Schnittstelle hinterlegt sein."
          example: "https://www.example.com/support"
        email:
          type: string
          format: email
          description: "Der E-Mail Adresse der Kontaktperson / -Organisation."
          example: "support@example.com"

    Contacts:
      description: "The list of contacts and their settings"
      type: object
      properties:
        contacts:
          description: "The list of contacts and their settings"
          type: array
          items:
            $ref: "#/components/schemas/Contact"
          readOnly: true

    CreateRoomRequest:
      description: "Information for a new room"
      allOf:
        - $ref: "#/components/schemas/RoomProperties"
      properties:
        invitedMembers:
          description: "List of accounts to invite into the new room"
          type: array
          items:
            $ref: "#/components/schemas/MxId"

    DeviceInfo:
      description: "Claim information about a device"
      required:
        - deviceId
        - deviceName
        - deviceStatus
        - claimerName
        - claimedUntil
      readOnly: true
      type: object
      properties:
        deviceId:
          type: integer
          format: int64
          description: "Identifier of the device"
          example: 4711
        deviceName:
          type: string
          description: "Name of the device"
          example: "awesome_device_01"
        deviceStatus:
          type: string
          enum: [ claimed, free ]
          description: "Status of the device"
        claimerName:
          type: string
          description: "Name of the claimer"
          example: "some name"
        claimerCn:
          type: string
          description: "Common name of claimers client cert"
          example: "gematik GmbH"
        cn:
          type: string
          description: "Common name of the deposited HBA/SMC-B if existing"
          example: "Dr Renate Grunner"
        telematikId:
          type: string
          description: "TelematikId of the deposited HBA/SMC-B if existing"
          example: "Grunner-test-only"
        claimedUntil:
          type: string
          format: date-time
          description: "Time until device is unclaimed. Each interaction with device extends claim time."
          example: 2022-04-01T08:30:00Z

    Devices:
      description: "The list of connected devices and their status"
      type: object
      properties:
        devices:
          description: "The list of connected devices and their status"
          type: array
          items:
            $ref: "#/components/schemas/DeviceInfo"
          readOnly: true

    DirectMessage:
      description: "A direct message to an other account."
      type: object
      properties:
        toAccount:
          type: string
          description: "The recipients account ID. Can be the mxId or an other account id returned by the searchInFhirDirectory operations."
          example: "@someone:gematik.de"
      allOf:
        - $ref: "#/components/schemas/MessageContent"

    Error:
      description: "Default error object with information about the occurred error"
      type: object
      properties:
        errorCode:
          description: "A code identifying this error"
          type: string
        errorMessage:
          description: "A readable message describing the error"
          type: string
      required:
        - errorCode
        - errorMessage

    FhirAddress:
      type: object
      description: "Possible address"
      properties:
        use:
          type: string
          description: "For what should this address be used"
          example: "work"
        type:
          type: string
          description: "Describes what kind of address is it"
          example: "postal"
        text:
          type: string
          description: "Full address in one text"
          example: "Müllersteige 38 74626 Bretzfeld Baden-Württemberg DE"
        line:
          type: array
          example: [ "Müllersteige 38" ]
          description: "Multiple address lines"
          items:
            type: string
        city:
          type: string
          description: "City of address"
          example: "Bretzfeld"
        state:
          type: string
          description: "State of address"
          example: "Baden-Württemberg"
        postalCode:
          type: string
          description: "Postal code of address"
          example: "74626"
        country:
          type: string
          description: "Country code of address"
          example: "DE"

    FhirAvailableTime:
      type: object
      description: "Available time for one day of the week"
      properties:
        daysOfWeek:
          type: array
          description: "A single abbreviated week day"
          example: [ "tue" ]
          items:
            type: string
        availableStartTime:
          type: string
          description: "Start time"
          example: "08:00:00"
        availableEndTime:
          type: string
          description: "End time"
          example: "18:00:00"

    FhirBaseResource:
      type: object
      description: "FhirBaseResource"
      discriminator:
        propertyName: resourceType
        mapping:
          Organization: "#/components/schemas/FhirOrganization"
          HealthcareService: "#/components/schemas/FhirHealthcareService"
          PractitionerRole: "#/components/schemas/FhirPractitionerRole"
          Location: "#/components/schemas/FhirLocation"
          Endpoint: "#/components/schemas/FhirEndpoint"
          Practitioner: "#/components/schemas/FhirPractitioner"
      required:
        - resourceType
      properties:
        resourceType:
          $ref: "#/components/schemas/FhirResourceType"
        id:
          type: string
          description: "UUID of resource"
          example: "97563406-5836-475d-9ee6-48e02917dae2"
        meta:
          $ref: "#/components/schemas/FhirMeta"
        text:
          $ref: "#/components/schemas/FhirText"
        identifier:
          type: array
          items:
            $ref: "#/components/schemas/FhirIdentifier"

    FhirCodeableConcept:
      description: "Coding object"
      type: object
      properties:
        coding:
          type: array
          items:
            $ref: "#/components/schemas/FhirCoding"
        text:
          type: string
          description: "Plain text representation of the concept"

    FhirCoding:
      description: "Coding object"
      type: object
      properties:
        system:
          type: string
          example: "http://terminology.hl7.org/CodeSystem/v2-0203"
        code:
          type: string
          example: "PRN"
        display:
          type: string
          example: "TI-Messenger chat"

    FhirConnectionType:
      description: "Connection type for this endpoint"
      type: object
      properties:
        system:
          type: string
          example: "https://gematik.de/fhir/directory/CodeSystem/EndpointDirectoryConnectionType"
        code:
          type: string
          example: "tim"

    FhirEndpoint:
      description: "Information about this endpoint"
      allOf:
        - $ref: "#/components/schemas/FhirBaseResource"
      type: object
      required:
        - name
        - address
      properties:
        name:
          type: string
          description: "Name of the resource"
          example: "Surgery station"
        managingOrganization:
          type: string
          description: "Name of managing organization"
          example: "Charite Berlin"
        status:
          type: string
          description: "Status of the resource"
          example: "active"
          enum: [ active, suspended, "off" ]
        address:
          description: "For endpoint in tim context the mxid in uri scheme"
          type: string
          example: "matrix:u/test:gematik.de"
        connectionType:
          $ref: "#/components/schemas/FhirConnectionType"
        payloadType:
          type: array
          items:
            $ref: "#/components/schemas/FhirCodeableConcept"
        extension:
          type: array
          items:
            $ref: "#/components/schemas/FhirExtension"

    FhirEntry:
      description: "FhirSearchEntry"
      type: object
      required:
        - resource
      properties:
        fullUrl:
          type: string
          description: "The full URL to the resource"
          example: "https://fhir-directory-ref.vzd.ti-dienste.de/owner/HealthcareService/97563406-5836-475d-9ee6-48e02917dae2"
        resource:
          $ref: "#/components/schemas/FhirBaseResource"
        search:
          $ref: "#/components/schemas/FhirSearch"

    FhirExtension:
      description: "Additional content defined by implementations"
      type: object
      required:
        - url
        - valueCoding
      properties:
        url:
          type: string
        valueCoding:
          $ref: "#/components/schemas/FhirCoding"

    FhirHealthcareService:
      description: "Information about this healthcareService"
      allOf:
        - $ref: "#/components/schemas/FhirBaseResource"
      type: object
      required:
        - name
      properties:
        name:
          type: string
          description: "Name of the healthcareService"
          example: "Surgery station"
        providedBy:
          $ref: "#/components/schemas/FhirReference"
        location:
          type: array
          items:
            $ref: "#/components/schemas/FhirReference"
        telecom:
          type: array
          items:
            $ref: "#/components/schemas/FhirTelecom"
        endpoint:
          type: array
          items:
            $ref: "#/components/schemas/FhirReference"
        serviceProvisionCode:
          type: array
          items:
            $ref: "#/components/schemas/FhirCodeableConcept"
        communication:
          type: array
          items:
            $ref: "#/components/schemas/FhirCodeableConcept"
        appointmentRequired:
          type: boolean
          description: "Is an appointment mandatory"
        availableTime:
          type: array
          items:
            $ref: "#/components/schemas/FhirAvailableTime"
        availabilityExceptions:
          type: string
          description: ""
          example: "Closed on Friday 3.14.15926"

    FhirIdentifier:
      description: "Identifier for this object"
      type: object
      properties:
        system:
          type: string
          example: "https://gematik.de/fhir/directory/CodeSystem/ldapUID"
        value:
          type: string
          example: "681b6c9f-a9d1-4dea-937c-4e4cf70b1f31"
        type:
          $ref: "#/components/schemas/FhirType"

    FhirLocation:
      description: "FhirLocation"
      allOf:
        - $ref: "#/components/schemas/FhirBaseResource"
      type: object
      properties:
        name:
          type: string
          description: "Name of the location"
          example: "Surgery station"
        address:
          $ref: "#/components/schemas/FhirAddress"

    FhirMeta:
      description: "Metadata of resource"
      type: object
      properties:
        lastUpdated:
          type: string
          format: date-time
          description: "Time when the depending resource was last updated"
          example: 2022-04-01T08:30:00Z
        versionId:
          type: string
          description: "How many times this resource has been updated"
          example: "2"
        source:
          type: string
        profile:
          type: array
          items:
            $ref: "#/components/schemas/FhirProfile"
        tag:
          type: array
          items:
            $ref: "#/components/schemas/FhirTag"

    FhirName:
      type: object
      description: "Personal data of practitioner"
      required:
        - text
      properties:
        use:
          example: "usual"
          description: "Use of the name"
          type: string
        text:
          example: "Kersta Hoefler"
          description: "Full Name"
          type: string
        family:
          example: "Hoefler"
          description: "Last name"
          type: string
        given:
          type: array
          items:
            type: string
          description: "First names"
          example: [ "Kersta" ]
        prefix:
          type: array
          items:
            type: string
          description: "Title and other prefixes"
          example: [ "Dr.", "Prof." ]

    FhirOrganization:
      description: "Information about the organisation"
      allOf:
        - $ref: "#/components/schemas/FhirBaseResource"
      type: object
      properties:
        name:
          type: string
          description: "Name of the organization"
          example: "Surgery station"
        active:
          type: boolean
          description: "Is resource active"
        type:
          type: array
          items:
            $ref: "#/components/schemas/FhirType"
        alias:
          type: array
          items:
            type: string

    FhirPractitioner:
      description: "Information about the practitioner"
      allOf:
        - $ref: "#/components/schemas/FhirBaseResource"
      type: object
      properties:
        active:
          type: boolean
          description: "Is resource active"
        name:
          type: array
          items:
            $ref: "#/components/schemas/FhirName"
        telecom:
          type: array
          items:
            $ref: '#/components/schemas/FhirTelecom'

    FhirPractitionerRole:
      description: "Information about the practitioner, location and endpoint"
      allOf:
        - $ref: "#/components/schemas/FhirBaseResource"
      type: object
      required:
        - practitioner
      properties:
        practitioner:
          $ref: "#/components/schemas/FhirReference"
        location:
          type: array
          items:
            $ref: "#/components/schemas/FhirReference"
        endpoint:
          type: array
          items:
            $ref: "#/components/schemas/FhirReference"

    FhirProfile:
      description: "Url to FHIR profile of the resource"
      type: string
      example: "https://gematik.de/fhir/directory/StructureDefinition/HealthcareServiceDirectory"

    FhirReference:
      description: "Reference to another Fhirresource"
      type: object
      required:
        - reference
      properties:
        reference:
          type: string
          description: "ResourceType and followed by ID of the other reference divided by '/'"
          example: "Organization/681b6c9f-a9d1-4dea-937c-4e4cf70b1f31"

    FhirResourceType:
      type: string
      description: "Name of resourceType"
      example: "HealthcareService"
      enum: [ HealthcareService, Organization, Location, Endpoint, Practitioner, PractitionerRole ]

    FhirSearch:
      description: "Description of search type"
      type: object
      properties:
        mode:
          type: string
          example: "match"

    FhirSearchResult:
      description: "A FHIR Bundle containing search results"
      type: object
      required:
        - total
      properties:
        resourceType:
          type: string
          example: "Bundle"
        id:
          type: string
          example: "b2d4770f-2e18-4284-za6d-cb8463e5ea70"
        meta:
          $ref: "#/components/schemas/FhirMeta"
        type:
          type: string
        total:
          type: integer
          example: 2
          minimum: 0
          maximum: 100
          format: int64
          description: "Number of all found entries"
        entry:
          type: array
          items:
            $ref: "#/components/schemas/FhirEntry"

    FhirTag:
      description: "Tag for resource"
      properties:
        system:
          type: string
          example: "https://gematik.de/fhir/directory/CodeSystem/Origin"
        code:
          type: string
          description: "Code identifier for tag"
          example: "ldap"
        display:
          type: string
          description: "What should be displayed for this tag"
          example: "Synchronized from LDAP VZD"
        userSelected:
          type: boolean
          example: true

    FhirTelecom:
      description: "Alternative communication connection"
      type: object
      properties:
        system:
          type: string
          example: "phone"
          description: "one of phone | fax | email | pager | url | sms | other"
        value:
          type: string
          example: "030-606 06 60"
          description: "The actual value"
        use:
          type: string
          example: "work"
          description: "home | work | temp | old | mobile - purpose of this contact point"

    FhirText:
      description: "Object of text"
      type: object
      properties:
        status:
          type: string
          example: "generated"
        div:
          type: string
          example: "This is a sync generated HealthcareService"

    FhirType:
      description: "FhirType"
      type: object
      properties:
        coding:
          type: array
          items:
            $ref: "#/components/schemas/FhirCoding"

    GroupName:
      description: "The name of the group to be allowed or blocked"
      type: string
      enum: [ isInsuredPerson ]
      example: "isInsuredPerson"

    HomeserverSearchResult:
      description: "A flat description of an endpoint with belonging healthcare-service and organization"
      readOnly: true
      type: object
      required:
        - mxId
      properties:
        mxId:
          description: "The Matrix-ID of an account"
          type: string
          example: "@someone:gematik.de"
        displayName:
          description: "The displayName"
          type: string
          example: "some name"

    HomeserverSearchResultList:
      description: "The result for a search request for on homeserver"
      readOnly: true
      type: object
      required:
        - totalSearchResults
        - searchResults
      properties:
        totalSearchResults:
          description: "Total result count for this search. The number of entries in searchResults may be less or equal this number."
          type: integer
          example: 42
        searchResults:
          description: "The list of search results. Its size May be smaller than totalSearchResults, if there are many results."
          type: array
          items:
            $ref: "#/components/schemas/HomeserverSearchResult"

    InfoObject:
      description: "Additional information about the connected software"
      required:
        - title
        - clientInfo
        - fachdienstInfo
        - testDriverVersion
        - homeserver
        - contact
        - description
      readOnly: true
      type: object
      properties:
        title:
          type: string
          description: "Der Titel der Anwendung"
          example: "Test-Schnittstelle des TI-Messenger Clients"
        description:
          type: string
          description: "Eine kurze Beschreibung der Anwendung"
          example: "TI-Messenger-Client Test-Schnittstelle"
        termsOfService:
          type: string
          format: uri
          description: "Eine URL zu den Terms of Service für dieses API."
          example: "https://example.com/terms/"
        homeserver:
          type: string
          description: "Name des zuständigen Homeservers"
          example: "gematik.de"
        contact:
          $ref: "#/components/schemas/ContactInfo"
        clientInfo:
          $ref: "#/components/schemas/ClientSoftwareInfo"
        fachdienstInfo:
          $ref: "#/components/schemas/SoftwareInfo"
        testDriverVersion:
          type: string
          description: "Version of the implemented TiMessengerTestDriver"
          example: "1.0.0"

    Login:
      description: "Login data"
      type: object
      allOf:
        - $ref: "#/components/schemas/BasicAuthStage"
      properties:
        authStage:
          $ref: "#/components/schemas/AuthStageName"

    matrixKeyInfo:
      description: "Information about recoveryKey"
      type: object
      properties:
        mxId:
          $ref: "#/components/schemas/MxId"
        key:
          type: string
          description: "The actual key"
          example: "123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"

    MediaFileId:
      description: "A unique id to a previously uploaded file. For example an UUID."
      required:
        - fileId
      properties:
        fileId:
          type: string
          example: "74738ff5-5367-5958-9aee-98fffdcd1876"

    Message:
      description: "A message and its metadata"
      readOnly: true
      type: object
      required:
        - author
      properties:
        event_id:
          type: string
          description: "The globally unique identifier for this event."
          example: "$HLBTpCvLsh7Zm8eivY25SC9NMWWv2jHElYVJaCHJ37c"
        type:
          type: string
          description: "The type of the event"
          example: "m.room.message"
        messageId:
          type: string
          description: "The message identifier. Must be returned in response to a sendMessage request. Is used to delete a specific message."
          example: "06eaad80-f8ce-4dce-82bc-62dd194e626c"
        timestamp:
          type: string
          format: date-time
          example: 2021-07-20T17:32:28Z
          description: "Timestamp of sending the message"
        lastUpdated:
          type: string
          format: date-time
          example: 2021-07-20T18:32:28Z
          description: "Timestamp of last editing"
        author:
          type: string
          description: "MxId of the author of this message"
        origin_server_ts:
          type: integer
          format: int64
          description: "Timestamp (in milliseconds since the unix epoch) on originating homeserver when this event was sent."
          example: 1738838934261
        room_id:
          type: string
          description: "The ID of the room associated with this event."
          example: "!BmMriOJBQAlLhHSCLQ:matrix.org"
      allOf:
        - $ref: "#/components/schemas/MessageContent"

    MessageContent:
      description: "Content of a message"
      type: object
      required:
        - body
        - msgtype
      properties:
        body:
          type: string
          description: "The textual representation of this message."
          example: "hi there"
        msgtype:
          type: string
          description: "The type of message, e.g. m.image, m.text. See https://spec.matrix.org/v1.3/client-server-api/#mroommessage-msgtypes for more information"
          example: "m.text"
        fileId:
          type: string
          description: "File id - for example an UUID"
          example: "74738ff5-5367-5958-9aee-98fffdcd1876"
        info:
          type: object
          properties:
            mimetype:
              type: string
              description: "Mimetype of the file located at {url}"
              example: "image/jpeg"
            size:
              type: integer
              description: "Size of the file in bytes."
              example: 123456
        format:
          type: string
          description: "The format used in the formatted_body. Only org.matrix.custom.html is supported."
          example: "org.matrix.custom.html"
        formatted_body:
          type: string
          description: "The formatted version of the body, when it acts as a caption. This is required if format is specified."
          example: "<b>This is an example text message</b>"
        filename:
          type: string
          description: "The original filename of the uploaded file."
          example: "something-important.doc"
        file:
          type: object
          required:
            - url
            - key
            - iv
            - hashes
            - v
          description: "Encrypted media file information, including URL, encryption key, IV, and hash. Used for secure media sharing in Matrix messages."
          properties:
            url:
              type: string
              description: "The URL to the file."
              example: "mxc://matrix.org/HErreTZgdnUUKBDCRkbMlPyX"
            v:
              type: string
              description: "Version of the encrypted attachment’s protocol. Must be v2."
              example: "v2"
            key:
              $ref: "#/components/schemas/MessageContentFileKey"
            iv:
              type: string
              description: "The 128-bit unique counter block used by AES-CTR, encoded as unpadded base64."
              example: "3mUNzXhtlSYAAAAAAAAAAA"
            hashes:
              type: object
              description: "A map from an algorithm name to a hash of the ciphertext, encoded as unpadded base64."
              properties:
                sha256:
                  type: string
                  description: "SHA-256 hash of the encrypted file."
                  example: "JsonRvH9Pa05eQTR6uOs35qzsLRqY8b2AxIJ6IY/OZo"
        geo_uri:
          type: string
          description: "A geo URI (RFC5870) representing this location."
          example: "geo:51.5008,0.1247"

    MessageContentFileKey:
      description: "A JSON Web Key object."
      type: object
      required:
        - alg
        - ext
        - k
        - key_ops
        - kty
      properties:
        alg:
          type: string
          description: "Algorithm. Must be A256CTR."
          example: "A256CTR"
        ext:
          type: boolean
          description: "Extractable. Must be true. This is a W3C extension."
          example: true
        k:
          type: string
          description: "The key, encoded as urlsafe unpadded base64."
          example: "8mAj7ykxlizPrN2SdXNU3HCw1lZ-ZrukVZjCQstmR4M"
        key_ops:
          type: array
          items:
            type: string
          description: "Key operations. Must at least contain encrypt and decrypt."
          example: [ "encrypt", "decrypt" ]
        kty:
          type: string
          description: "Key type. Must be oct."
          example: "oct"

    Messages:
      description: "A list of messages and its properties"
      type: array
      items:
        $ref: "#/components/schemas/Message"

    MxId:
      description: "The Matrix-ID of an account"
      type: object
      required:
        - mxid
      properties:
        mxid:
          description: "The Matrix-ID of an account"
          type: string
          example: "@someone:gematik.de"

    OperatingSystem:
      description: "Enum of possible operating systems"
      type: string
      enum: [ Windows, OSx, iOS, Android, Linux ]

    OsInfo:
      description: "General information about the underlying operating system"
      required:
        - operatingSystem
      type: object
      properties:
        operatingSystem:
          $ref: "#/components/schemas/OperatingSystem"
        version:
          description: "Version of the OS"
          example: "1.0.0"
          type: string

    Room:
      description: "Information about a room and its members"
      allOf:
        - $ref: "#/components/schemas/RoomProperties"
        - $ref: "#/components/schemas/RoomMembers"

    RoomInvite:
      description: "List of accounts to invite into a room"
      type: array
      items:
        $ref: "#/components/schemas/MxId"

    RoomMember:
      description: "Accounts related to this room"
      type: object
      required:
        - mxid
        - membershipState
      properties:
        mxid:
          description: "MxId as identifier, refers to an existing account"
          type: string
          example: "@someone:gematik.de"
        membershipState:
          $ref: "#/components/schemas/RoomMembershipState"

    RoomMembers:
      description: "List of room associated accounts and their states"
      type: object
      required:
        - members
      properties:
        members:
          type: array
          description: "Associated accounts of the room and their states"
          items:
            $ref: "#/components/schemas/RoomMember"

    RoomMembershipState:
      description: "Membership state of an account for a room"
      type: string
      enum: [ knock, invite, join, ban, leave ]

    RoomProperties:
      description: "Some general properties of a room"
      type: object
      required:
        - name
      properties:
        name:
          type: string
          description: "The name of the room"
          example: "some room"
        theme:
          type: string
          description: "The theme of the room"
          example: "some theme"
        roomAccess:
          type: string
          enum: [ private, public ]
          description: "The visibility of the room"
        isEncrypted:
          type: boolean
          readOnly: true
          description: "The room should always be encrypted"
        roomId:
          type: string
          description: "The room identifier. Must be returned in response to a createRoom request. Is used to identify a specific room."
          example: "!dowjfsdkjfskjdfsd:gematik.de"
        roomVersion:
          type: string
          description: "The room version"
          example: "10"

    RoomState:
      description: "Description of a room state event"
      type: object
      required:
        - type
        - roomId
        - eventId
      properties:
        content:
          type: string
          format: json
          description: "This value is very custom. Should be json formatted"
          example: "{ join_rule: public }"
        eventId:
          type: string
          description: "Id of the event"
          example: "$143273582443PhrSn:example.org"
        roomId:
          type: string
          description: "Id of belonging room"
          example: "!636q39766251:example.com"
        sender:
          type: string
          description: "@example:example.org"
          example: "MxId of the creator"
        stateKey:
          type: string
          description: "Present if, and only if, this event is a state event. The key making this piece of state unique in the room. Note that it is often an empty string."
          example: ""
        type:
          type: string
          description: "The type of the event"
          example: "de.gematik.tim.room.casereference.v1"

    RoomStates:
      description: "List of room states"
      type: array
      items:
        $ref: "#/components/schemas/RoomState"

    Rooms:
      description: "List of rooms and their properties"
      type: array
      items:
        $ref: "#/components/schemas/Room"

    ServerName:
      description: "A Server-Name: https://spec.matrix.org/v1.11/appendices/#server-name"
      type: object
      required:
        - serverName
      properties:
        serverName:
          description: "The Server-Name"
          type: string
          example: "matrix.org"

    SoftwareInfo:
      description: "General information about the software"
      required:
        - name
        - version
      type: object
      properties:
        name:
          type: string
          description: "Name of the provided software"
          example: "TI-Messenger-Software"
        description:
          description: "A short description of the provided software"
          example: "The TI-Messenger-Software is an implementation of the TI-Messenger specification."
          type: string
        version:
          description: "The version of the software"
          example: "1.0.0"
          type: string
        osInfo:
          $ref: "#/components/schemas/OsInfo"
        applicationType:
          $ref: "#/components/schemas/ApplicationType"
        contact:
          $ref: "#/components/schemas/ContactInfo"
        matrixVersion:
          type: string
          example: "1.3"
          description: Implemented version of matrix protocol https://spec.matrix.org/latest/



  # Mutual TLS is used for authentication of clients. In openAPI 3.0.x is mTLS not supported. Therefore the security scheme is not used.
  #  securitySchemes:
  #    mTLS:
  #      type: mutualTLS
  #
  #
  #security:
  #  - mTLS:
  #
