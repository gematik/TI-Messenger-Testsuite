:toc-title: Inhaltsverzeichnis
:toc:
:toclevels: 4

:tip-caption:  pass:[&#128681;]

:classdia-caption: Class diagram
:seqdia-caption: Sequence diagram

:source-highlighter: prettify

:imagesdir: ../../doc/images
:imagesoutdir: ../images
:testdir: ../../Tests
:sourcedir: ../../src
:plantumldir: ../plantuml
:rootdir: ../../

[[id0,Inhaltsverzeichnis]]
= TI-Messenger-Dienst Release 1.1.0

image::gematikLogoRight.png[float="right"]

== TI-Messenger-Dienst Testsuite
{empty} +

image::Intro.png[float="left"]
=== 1. Einführung
{empty} +

Im folgenden Kapitel finden sie alle nötigen Informationen zu den bereitgestellten Testfällen.
Alle wichtigen Informationen für die Hersteller sind wie folgt gekennzeichnet.

[TIP]
[black]#*_Wichtige Informationen für die Hersteller_*#

[.text-right]
<<id0,Inhaltsverzeichnis>>

image::TI-Messenger.png[float="left"]
==== 1.1 TI-Messenger-Dienst Systemübersicht
{empty} +

Bei der Umsetzung der Funktionalitäten des TI-Messenger-Dienstes sind mehrere Komponenten beteiligt,
die durch verschiedene Anbieter bereitgestellt werden. Die folgende Abbildung zeigt alle an der
TI-Messenger-Architektur beteiligten Komponenten mit deren Schnittstellen.

image:System.png[float="center"]
&nbsp; &nbsp; &nbsp;Abbildung : Komponenten der TI-Messenger-Architektur und deren Schnittstellen (gemSpec_TI-Messenger-Dienst)

[.text-right]
<<id0,Inhaltsverzeichnis>>

image::TI-Messenger.png[float="left"]
==== 1.1 TI-Messenger-Dienst Anwendungsfälle
{empty} +

Für jeden zu testenden Anwendungsfall wurde ein Feature File angelegt. In diesem Feature File befinden sich
dann die einzelnen Tests für den jeweiligen Anwendungsfall.

[cols='^1,1,6,4']
|===
| *Feature File* | *AF Nummer*               | *Beschreibung*                                               | *Anmerkung*
|                | AF_10103                  | Authentisieren einer Organisation am TI-Messenger-Dienst     | wird nicht mit der Testsuite getestet ^1)^
|                | AF_10060                  | Bereitstellung eines Messenger-Service für eine Organisation | wird nicht mit der Testsuite getestet ^1)^
| 03             | AF_10059                  | Organisationsressourcen im Verzeichnisdienst hinzufügen      |
| 04             | AF_10057                  | Anmeldung eines Akteurs am Messenger-Service                 |
| 05             | AF_10058                  | Akteur (User-HBA) im Verzeichnisdienst hinzufügen            |
|                | AF_10064                  | Föderationszugehörigkeit eines Messenger-Service prüfen      | wird im AF_10104 und AF_10061 mit getestet ^2)^
| 07             | AF_10104                  | Einladung von Akteuren innerhalb eines Messenger-Service     |
| 08             | AF_10063                  | Austausch von Events innerhalb eines Messenger-Service       |
| 09             | AF_10061                  | Einladung von Akteuren anderer Messenger-Services            |
| 10             | AF_10062                  | Austausch von Events zwischen anderen Messenger-Services     |
| 11             | AF_10061                  | Einladung von Akteuren via Freigabeliste                     |
|===

^1)^ Die Schnittstelle am Registrierungs-Dienst wird nicht durch die gematik normativ vorgegeben. Sie bietet einem
Akteur in der Rolle "Org-Admin" einer Organisation die Möglichkeit, Messenger-Services für seine Organisation zu
administrieren. Bei dieser Schnittstelle bleibt es dem TI-Messenger-Anbieter überlassen diese in geeigneter Form
bereitzustellen. Die gematik gibt lediglich grundlegende bereitzustellende Funktionen vor und führt auch keine Tests
an dieser Schnittstelle durch.

^2)^ Für diesen Anwendungsfall wurden kein Feature File angelegt.

[.text-right]
<<id0,Inhaltsverzeichnis>>

image::TI-Messenger.png[float="left"]

==== 1.2 Zusätzliche Anwendungsfälle
{empty} +

Neben den Anwendungsfällen, die in der Spezifikation beschrieben sind, wurden noch zwei weitere Anwendungsfälle für die Tests definiert. In diesen Anwendungsfällen werden
Gruppenchats und die Nutzung von mehreren Geräten getestet. Die Anfrage der Geräte-Information aller Schnittstellen hat nur informativen Charakter.

[cols='^1,1,6,4']
|===
| *Feature File* | *AF Nummer* | *Beschreibung*                                               | *Anmerkung*
| 00             | ohne        | Abfragen der Geräte-Information aller Schnittstellen         | nur zur Info
| 12             | ohne        | Gruppen Chats                                                |
| 13             | ohne        | Nutzung von mehreren Geräten                                 |
|===

[.text-right]
<<id0,Inhaltsverzeichnis>>

image:Akteur2.png[float="left"]image:Akteur1.png[float="left"]

=== 2. Akteure des TI-Messenger-Dienst
{empty} +

image:UC_org_admin.png[float="center"]

image:UC_user_HBA.png[]

[.text-right]
<<id0,Inhaltsverzeichnis>>

image::Testsuite.png[float="left"]

=== 3. Akteure in der TI-Messenger-Testsuite
{empty} +

image::HBA.png[float="left"]

==== 3.1 HBA - User
{empty} +

Die Rolle "User-HBA" kann ausschließlich von einem Leistungserbringer eingenommen werden. Die
Authentifizierung des Akteurs erfolgt hierbei über seinen HBA. Ein Akteur in der Rolle "User-HBA"
kann seine MXID im Personenverzeichnis im VZD-FHIR-Directory hinterlegen, damit andere Akteure in
der Rolle "User-HBA", die ebenfalls die eigene MXID auf dem VZD-FHIR-Directory hinterlegt haben,
ihn kontaktieren können.

[TIP]
[black]#*_Für Akteure Practitioner müssen HBAs von den Herstellern bestellt werden <<id43,Anforderungen an die Clients>>._*#

[.text-right]
<<id0,Inhaltsverzeichnis>>

image:Akteur2.png[float="left"]image:Akteur1.png[float="left"]

==== 3.2 Organisations User
{empty} +

Die Rolle "User" kann von einem Leistungserbringer sowie von einem Mitarbeiter im Gesundheitswesen
eingenommen werden. Die Authentifizierung des Akteurs erfolgt hierbei nicht über eine SMC-B oder
einen HBA, sondern über ein vom Messenger-Service bereitgestelltes Authentifizierungsverfahren.
Für einen Akteur in der Rolle "User" kann dessen MXID im Organisationsverzeichnis auf dem
VZD-FHIR-Directory hinterlegt werden, um für Akteure außerhalb seiner Organisation auffindbar zu werden. +
{empty} +
Die Oragnisations User können auch gleichzeitig HBA-User sein. Das bedeutet die Organisation trägt die MXID
der HBA-User in den Endpoint des Healthcare Services ein.

[TIP]
[black]#*_Für die Einrichtung von Organisations User werden eine Domain und eine Organisation benötigt <<id41,Messenger-Service für eine Organisation>>._*#

[.text-right]
<<id0,Inhaltsverzeichnis>>

image:SMC-B.png[float="left"]

==== 3.3 Org-Admin
{empty} +

Die Rolle "Org-Admin" stellt eine besondere Rolle im TI-Messenger Kontext dar. Leistungserbringer
oder Mitarbeiter einer Organisation können diese Rolle einnehmen, nachdem sie ihre Organisation zuvor
erfolgreich am Registrierungs-Dienst unter Verwendung ihrer SMC-B authentifiziert haben. Nach der
erfolgreichen Authentifizierung wird ein Admin-Account am Registrierungs-Dienst vom
TI-Messenger-Fachdienst angelegt. Mit der Anmeldung am Registrierungs-Dienst über den Admin-Account
nimmt ein Akteur die Rolle "Org-Admin" ein. Dieser kann Messenger-Services für seine Organisation
registrieren und Einträge im VZD-FHIR-Directory verwalten.

[TIP]
[black]#*_Für die Akteure Org-Admins müssen SMC-Bs von den Herstellern bestellt werden <<id43,Anforderungen an die Clients>>._*#

[.text-right]
<<id0,Inhaltsverzeichnis>>

image:Hersteller.png[float="left"]

=== 4. Bereitstellungen der Hersteller
{empty} +

Um die Testsuite ausführen zu können sind bestimmte Bereitstellungen durch die Hersteller erforderlich. Folgende
Absätze beschreiben die benötigten Bereitstellungen der Hersteller.
{empty} +
{empty} +

image:KH.png[float="left"]

[[id41,Messenger-Service für eine Organisation]]
==== 4.1 Messenger-Service für eine Organisation
{empty} +

[TIP]
[black]#*_Testkarten (HBA/SMC-B) müssen von den Herstellern bestellt werden siehe <<id43,Anforderungen an die Clients>>._*#

[TIP]
[black]#*_Für die Ausführung der Testsuite werden eine Domain und eine Organisation benötigt. Diese Domain und Organisation
müssen von den Herstellern vor Beginn der Testphase eingerichtet werden und die Daten an die gematik übermittelt werden._*#

[TIP]
[black]#*_Die verwendeten Akteure/User müssen von den Herstellern auf dem Homeserver eingerichtet werden._*#

image::TestKonfiguration.png[]

[.text-right]
<<id0,Inhaltsverzeichnis>>

image:Smartphone.png[float="left"]

==== 4.2 Test Clients mit Testtreiberschnittstelle
{empty} +

Das folgende Bild zeigt die Anschaltung der Testtreiberschnittstelle und der Clients. Die Clients können über eine
externe oder interne Testtreiberschnittstelle mit der Testsuite remote oder local verbunden werden. Diese Leistung muss von
jedem Hersteller erbracht werden. Welche Clients eingesetzt werden, können die Hersteller selbstständig entscheiden.
Es werden nur bereitgestellte Clients zugelassen. +
Clients mit den gleichen Eigenschaften werden unter einer URL zusammengefasst. Diese URL wird dann in die Konfigurationsdatei
'combine_items.json' eingetragen. In dieser Datei werden alle Testobjekte verwaltet.

image:Clients.png[]

[.text-right]
<<id0,Inhaltsverzeichnis>>

image:Smartphone.png[float="left"]


[[id43,Anforderungen an die Clients]]
==== 4.3 Anforderungen an die Clients
{empty} +

Die Testsuite benötigt für die Ausführung der Tests eine bestimmte Anzahl von Clients. Besonders die Tests für den Gruppen
Chat benötigen diverse Endgeräte. +

[TIP]
[black]#*_Grundsätzlich müssen an jeder Schnittstelle mindestens drei Gräte zur Verfügung stehen
(z.B. 3 x IOS Clients, 3 x Android Clients, 3 x Windows Clients usw.).
Ausgenommen von dieser Festlegung ist der Org-Admin, hier ist ein Geräte ausreichend._*#

[TIP]
[black]#*_Die Clients benötigen Testidentitäten (SMC-B/HBA karten). Die Kartenbestellung erfolgt über das gematik Fachportal: +
https://fachportal.gematik.de/gematik-onlineshop/testkarten?ai%5Baction%5D=detail&ai%5Bcontroller%5D=Catalog&ai%5Bd_name%5D=Testkarte-eGK-G2&ai%5Bd_pos%5D=1_*#


[TIP]
[black]#*_Welche Testkarten müssen bestellt werden: +
1. "TestKarte SMC-B G2.1 Krankenhaus" oder "TestKarte SMC-B G2.1 Arztpraxis" +
   &nbsp; &nbsp; &nbsp;(1x für OrgAdmin Schnittstelle) +
2. "TestKarte HBA G2.1 Arzt" (3x pro Schnittstelle)_*#

[TIP]
[black]#*_Wenn mehere Hersteller die Testressourcen gleichzeitig nutzen wollen, muss die Anzahl der Clients deutlich erhöht werden._*#

[.text-right]
<<id0,Inhaltsverzeichnis>>

image:User.png[float="left"]

==== 4.4 Verwaltung der Ressourcen
{empty} +

Hinter jeder Schnittstelle des Testtreiber Moduls verbergen sich ggf. mehrere Devices (siehe 4.3) mit der gleichen Grundkonfiguration. Diese Grundkonfiguration betrifft:

- Client Version (Version vom TI-M)
- Betriebssystem (Os)
- Typ (Org-Admin oder Messenger-Client)

Pro Device muss neben allen anderen Daten genau 1 User inkl Passwort hinterlegt werden (1:1 Beziehung).

Dies gilt für Messenger-Clients ebenso wie Org-Admin Clients.

Wenn hinter dem Messenger-Client Device eine HBA liegt, um HBA Interaktionen z.B. mit dem VZD durchzuführen, müssen der User des Devices und der Name auf der HBA übereinstimmen. Somit kann sich dann der eingeloggte und hinterlegte User auch als HBA authentifizieren.

*Der hinterlegte User muss auf dem Homeserver bzw. der TI-M Instanz registriert sein*, so dass eine Anmeldung im TI-M über die Testtreiber Schnittstelle mittels POST Login möglich wird.

Der Start eines Testfalls sieht dann wie folgt aus:

- Get Device - Liste aller Device einer Schnittstelle werden abgefragt
- Claim Device - Ein Device im Status ‘unclaimed’ wird für den Testlauf geclaimt
- Post Login - Leerer Request Post Login mit der Device ID und der Response:

image::Response_Login.png[]

[TIP]
[black]#*_Wie der Testtreiber Schnittstellen Dokumentation zu entnehmen ist, wird ausschließlich ‚BasicAuth‘ genutzt._*#


[TIP]
[black]#*_Grundsätzlich liegt hinter jedem Device exakt ein User inkl. Passwort._*#

[TIP]
[black]#*_Wenn es sich um einen Practitioner-Client Device handelt, muss der User mit dem auf der hinterlegten HBA übereinstimmen_*#

[TIP]
[black]#*_Die Verwaltung der Domain, der Organisationen und der User liegt in der Verantwortung der Hersteller._*#

[TIP]
[black]#*_Weiterhin müssen die Hersteller die Schnittstellen für die TI-Messenger-Testsuite aktuell halten._*#

[.text-right]
<<id0,Inhaltsverzeichnis>>

image:Server.png[float="left"]

=== 5. Referenzimplementierung
{empty} +

Die gematik stellt eine TI-Messenger-Dienst Referenzimplementierung zur Verfügung. Zur Sicherstellung der Interoperabilität
zwischen verschiedenen TI-Messenger-Fachdiensten innerhalb des TI-Messenger-Dienstes muss der TI-Messenger-Dienst (TI-Messenger-Client
und TI-Messenger-Fachdienst)  eines  TI-Messenger-Anbieters gegen die Referenzimplementierung (TI-Messenger-Client und
TI-Messenger-Fachdienst) getestet werden.



[.text-right]
<<id0,Inhaltsverzeichnis>>

image::Tags.png[float="left"]

=== 6. Tags
{empty} +

image::Tag.png[float="left"]

==== 6.1 Tags zur Steuerung der Testsuite
{empty} +

*Tags für die Berechtigungsprüfung:*

[cols='1,3']
|===
| *Tag Name* | *Beschreibung*
| @BP:       | Tests mit Berechtigungsprüfung Es gibt weiterhin Tags für die <<id1,erfolgreiche>> und
für die <<id2,nicht erfolgreiche>> Berechtigungsprüfung.
|===

*Tags die zur Steuerung der Testsuite verwendet werden:*

[cols='1,3']
|===
| *Tag Name*              | *Beschreibung*
| @Ctl:Additional         | zusätzlichen Tests die kein direktes Akzeptanz-Kriterium bzw. keinen
                            Anwendungsfall haben
| @Ctl:UseCase            | Tests die UseCases aus der Spezifikation abbilden
| @Ctl:OneHomeServer      | Tests die mit nur einem Homeserver ausgeführt werden können
| @Ctl:SchnittstellenInfo | Tests die Schnittstellen Informationen abfragen
| @Ctl:OrgAdmin           | OrgAdmin Tests
| @Ctl:Chat               | Tests die einen Chat benutzen
| @Ctl:SearchPart         | Tests mit teilqualifizierter Suche
| @Ctl:Raum               | Tests die einen Raum benutzen
| @Ctl:InvitReject        | Tests mit abgelehnter Einladung
| @Ctl:RejectThird        | Tests Einladung von Dritten wir abgelehnt
| @Ctl:MsgForward         | Tests senden Nachrichten von A nach B
| @Ctl:MsgBackward        | Tests senden Nachrichten von B nach A
| @Ctl:MsgChange          | Tests mit geänderten Nachrichten
| @Ctl:MsgDelete          | Tests mit gelöschten Nachrichten
| @Ctl:MsgLogout          | Tests mit Offline-Geräten
| @Ctl:Attachment         | Tests mit Attachments
| @Ctl:Forbidden          | Berechtigungsprüfung lehnt Verbindung ab
| @Ctl:Freigabeliste      | Tests mit der Freigabeliste
| @Ctl:Gruppenchat        | Gruppenchat
| @Ctl:MultiDevices       | ein User verwendet mehrere Geräte
| @Ctl:NOVZD              | Tests die den VZD nicht benötigen
|===

*Zusätzlichen Tag zur Unterscheidung der Feature-Files:*

[cols='1,3']
|===
| *Tag Name* | *Beschreibung*
| @File:     | Filename
|===

*Tags für Polarion (Test-Management-Tool):*

[cols='1,3']
|===
|*Tag Name*  | *Beschreibung*
| @AF-ID:    | Verweis auf den Anwendungsfall (Spec und Polarion)
| @AK-ID:    | Verweis auf das Akzeptanz-Kriterium (Spec und Polarion)
| @PRIO:     | Testfall Priorität
| @PRODUKT:  | Verknüpft das Szenario oder das Feature zu einem Produkt
| @STATUS:   | Testfall Status
| @TCID:     | Testfall ID
| @TESTFALL: | Positiv/Negativ Test
|===

*Plugin Tags:*

[cols='1,3']
|===
| *Tag Name* | *Beschreibung*
| @Plugin:   | Steuerung des cucumber-test-combinations Plugins

|===

*Cucumber Tag:*

[cols='1,3']
|===
| *Tag Name* | *Beschreibung*
| @WIP       | Work in Progress
|===

[.text-right]
<<id0,Inhaltsverzeichnis>>

image::Tag.png[float="left"]

==== 6.2 Tags und Properties für die Plugin Konfiguration
{empty} +

Der BDD-Parameterizer (auch Kombinations-Plugin genannt) wird dazu genutzt die Testdaten-Kombinationen, in diesem Fall die APIs, zu steuern. Somit wird gewährleistet, dass genau das richtige Set an Daten für den jeweiligen Fokus des Testfalls erzeugt wird und dann in Iterationen ausgeführt werden können.

Grundlage hierfür ist das kartesische Produkt aller möglichen Kombinationen der in der generierten Target combine_items.json (target/generated-combine/combine_items.json) enthaltenen Schnittstellen. Mit Hilfe von Filtern, die direkt im .cute-File (später feature-File) gesetzt werden, kann nun diese Liste verkleinert und fokussiert werden.

Die *combine_items.json im Target Folder* (target/generated-combine/combine_items.json) wird aus der *Source combine_items.json* (src/test/resources/combine_items.json) und den aus der *Testtreiber Schnittstelle zum Device ausgelesenen Daten* (definiert in der pom.xml) erzeugt.

- Source combine_items.json - Bereitstellen der Schnittstelle (url). Evtl. zusätzliche Tags und Properties.
- pom.xml - Tags und Properties, die über die Testtreiber-Schnittstelle vom Device als Info-Daten (im Folgenden als "Info-Daten" bezeichnet) ausgelesen werden und für alle Schnittstellen gelten.
- Target combine_items.json - Das Produkt aus Source combine_items.json und ausgelesenen Info-Daten (pom.xml). Dies dient als Grundlage für die Kombinatorik.

Beispiel einer Source combine_items.json:

image::Source_combine_items.png[]


In der Source combine_items.json (src/test/resources/combine_items.json) enthalten sind:

- (Pflicht) *„value“*: Frei wählbarer Text (muss die URL zur Testtreiber Schnittstelle des jeweiligen Devices enthalten, wenn die Variable „url“ nicht befüllt wird)
- (Optional) *„url“*: URL zur Testtreiber Schnittstelle des jeweiligen Devices
- (Optional) *„tags“*: Tags, die nicht durch das Auslesen der Info-Daten gefüllt werden. Oder auch Tags, die durch das Auslesen der Info-Daten gefüllt werden und mit dem Wert in der combine_items.json verglichen werden sollen
- (Optional) *„properties“*: Properties, die nicht durch das Auslesen der Info-Daten gefüllt werden. Oder auch Properties, die durch das Auslesen der Info-Daten gefüllt werden und mit den Werten in der combine_items.json verglichen werden sollen

Hintergrund der Vergleichsoptionen von Tags und Properties ist, dass so z.B. schon vor dem Erstellen der Testdaten geprüft werden kann, dass die hinterlegten Devices an der genannten Schnittstelle den Anforderungen entsprechen, die notwendig sind.

*Vergleichsoptionen Tags*

Tags, die in der Source combine_itmes.json angegeben sind und ebenfalls aus einem Device ausgelesen werden sollen (definiert in der pom.xml), können miteinander verglichen werden. Dies geschieht case sensitive (1:1 Beziehung). Sollte sich der Tag in der combine_items.json und von dem in der pom.xml definierten unterscheiden, wird der Tag aus der Source combine_items.json als zusätzlicher Tag gewertet und in die Target combine_items.json übernommen.

Beispiel:

[cols='20%,20%,20%,20%,20%']
|===
| *Source combine_items.json* |*Definition in der pom.xml* | *Daten aus der TesttreiberSchnittstelle* |  *Aktion* | *Ergebnis in der Target combine_items.json*
| client                      | client                     | true                                     | Vergleich | Ein Eintrag (client)
| client                      | *nichts*                   | (nichts in der pom.xml definiert)        | Übernahme | Ein Eintrag (client)
| Client                      | client                     | true                                     | Übernahme | Zwei Einträge (client, Client)
| *nichts*                    | client                     | true                                     | Übernahme | Ein Eintrag (client)
| client                      | client                     | false                                    | Vergleich | Abbruch - Error
| *nicht*                     | client                     | false                                    | Übernahme | Abbruch - Error
|===

*Vergleichsoptionen Properties*

Geben wir z.B. die Property ‚os‘ (wie im obrigen Beispiel) mit einem entsprechenden Wert mit, so wird geprüft, ob das Device hinter der URL des Testtreibers tatsächlich dieses ‚os‘ hinterlegt hat, wenn diese Property ebenfalls in der pom.xml definiert ist. Die Überprüfung erfolgt hier case sensitive (iOS – iOS; usw).

[cols='40%,40%,20%']
|===
| *Source combine_items.json* |*Daten aus der TesttreiberSchnittstelle* | *Ergebnis Vergleich*
| iOS                         | Windows, Linux, Android, ...            | Abbruch - Error
| iOS                         | iOS                                     | OK
| iOS                         | IOS, ios                                | Abbruch - Error
| iOS                         | null                                    | Abbruch - Error
|===

Die potenitell möglichen Enum Werte sind in der Testtreiber Schnittstellenbeschreibung zu finden:

image::OS_Info.png[]

Die Daten, die von dem jeweiligen Device ausgelesen werden und die combine_items.json im Target Folder (target/generated-combine/combine_items.json) anreichern, werden in der pom.xml unter ‚cucumber-test-combinations-maven-plugin‘ definiert. Dies können Tags oder auch Properties sein.

Beispiel für die Erzeugung von Tags:

image::TagsPom.png[]

Tags werden erzeugt, wenn der eingegebene JSON-Path im "expression"-Teil true zurückliefert.

Beispiel für die Erzeugung von Properties:

image::propertiesPom.png[]

Properties werden erzeugt durch die auf der Schnittstelle hinterlegten Daten, die über die Testtreiber Schnittstelle ausgelesen werden. Auch hier sind in dem "expression"-Teil JSON-Paths anzugeben.

Nach der Generierung der Target combine_items.json sieht die Schnittstelle (oben aus dem Beispiel) inkl. aller definierten und verglichenen Daten dann wie folgt aus:

image::target_combine_items.png[]
[TIP]
[black]#*_In der Target combine_items.json (target/generated-combine/combine_items.json) sind dann alle Schnittstellen zu den Testtreibern der einzelnen Devices inkl aller notwendigen Daten hinterlegt. Mit Hilfe dieser Daten können dann die Testdaten für die Feature Files erzeugt und die einzelnen Tests ausgeführt werden._*#

Diese Tags und Properties dienen der direkten Steuerung der Testdaten, die zu einem bestimmten Testfall passen. In unserem Beispiel haben wir einen:

- Client
- Welcher neu (new) zu testen ist (dieser Tag wird in Kapitel 6.3 noch genauer erläutert)
- Dieser Client ist Preferred IOP (prefIOP) → Wird also in den IOP Tests bevorzugt genutzt
- Hinter diesem Client liegt eine HBA, somit sind auch ‚Practitioner‘ Handlungen z.B. im VZD möglich

Außerdem:

- Der Client gehört zur company „gematik GmbH“
- Wir befinden uns auf dem Homeserver „A“
- Sein OS ist „IOS“
- Die Versionen von Client und Testtreiber API

Anhand dieser Werte, die auch jederzeit erweiterbar sind, können wir nun mit Filtern unsere Testdaten erzeugen, die exakt zu dem Vorhaben des Testfalls passen.


Ein Beispiel:

Gehen wir an dieser Stelle einfach davon aus, dass wir *3 verschiedene Clients (IOS, Android, Windows) mit je einer HBA* und *einen Org-Admin Client* für Anbieter A vorliegen haben für diesen Testfall:

image::TestCase.png[]

Eine Chat-Kommunikation von 2 User mit einer HBA soll innerhalb einer Organisation über die Schittstellen <ApiName1A> und <ApiName1B> stattfinden.

Um nun das kartesische Produkt aller möglichen Kombinationen anzupassen, sagen wir nun:

- Alle Devices müssen auf dem gleichen Homeserver sein
- Sie sollen sich auch selbst kombinieren dürfen (z.B. IOS mit IOS, Android mit Android)
- Sie dürfen auch vice versa vorkommen (z.B. IOS-Android, Android-IOS)
- ApiName1A soll ein Client sein (kein OrgAdmin)
- ApiName1B soll ein Client sein (kein OrgAdmin)
- ApiName1A soll eine HBA hinterliegen, um Practitioner Handlungen durchzuühren
- ApiName1B soll eine HBA hinterliegen, um Practitioner Handlungen durchzuühren


Um dies zu erreichen werden nun folgende Filter mit Blick auf die Target combine_items.json angewandt:

image::TF_Filter.png[]


Der fertige Testfall sieht dann wie folgt aus:

image::TestCaseFertig.png[]

Nach dem Run des Plug-Ins ist das Resultat zum Ausführen des Testfalls dann folgendes
(hier zu finden: target/features/Zulassungstests/Testrun):

image::Kombi1.png[]

Wie wir nun sehen, wurde z.B. unser OrgAdmin Client ausgefiltert und eben die Kombinationen erzeugt, die wir brauchen
bzw. oben beschrieben haben.

Sichtbar ist in der Tabelle die Variable „Value“ aus der Target combine_items.json (target/generated-combine/combine_items.json), die einerseits frei wählbar ist oder die URL zur Testtreiber Schnittstelle enthält (siehe oben: Definition/Möglichkeiten in der Source combine_items.json).
Dieses Verfahren dient der klaren Visualisierung, welche Devices in einem Test genutzt werden, da URLs nicht immer Aufschluss darüber geben, welches Device exakt damit verbunden ist.

Es gibt weitere Filtermöglichkeiten, die auch in der TestSuite zum Einsatz kommen und in der Dokumentation zu
finden sind:

https://github.com/gematik/cucumber-test-combinations-maven-plugin/blob/main/doc/Userguide.adoc

Wie genau die Reihenfolge der Filterung funktioniert ist ebenfalls der Dokumentation zu entnehmen.

[.text-right]
<<id0,Inhaltsverzeichnis>>

image::Tag.png[float="left"]

==== 6.3 Special Tags [ ‚new‘ tag,'newonly' Profil und 'Practitioner' & 'perfIOP' Tag]
{empty} +

*‚new‘ Tag & ‚newonly‘ Profil*

Wenn der Tag ‚new‘ in einer Schnittstelle in der Source combine-items.json (src/test/resources/combine_items.json) gesetzt wurde (und damit auch in der Target combine_items.json enthalten ist) und das newonly Profil dazu gewählt wird, werden nach dem Durchlauf der Filter nur diejenigen Kombinationen genutzt, in denen eben der ‚new‘ Tag vorhanden ist.

Zum Beispiel von zuvor:

Unsere Beispiel Schnittstelle (IOS)

image::target_combine_items.png[]

hat den Tag ‚new‘. Alle anderen haben diesen nicht (Android und Win). Wenn wir nun das newonly Profil auswählen und die Kombinationen erzeugen, bekommen wir folgendes Ergebniss:

image::KombiNew.png[]

Wir sehen nun, dass nur Kombinationen erzeugt wurden, in denen unsere ‚new‘ Schnittstelle vorkommt. Hintergrund hierfür ist, dass so bestimmte Schnittstellen dediziert bzw. auch im IOP getestet werden können, wenn der Fokus nur diese Schnittstellen inkl. aller dazugehörigen Kombinationen ist.

[TIP]
[black]#*_Der ‚new‘ Tag wird nicht automatisch erzeugt, sondern muss nach Bedarf manuell vergeben bzw. entfernt werden in der Source combine_items.json (src/test/resources/combine_items.json)._*#


*Der 'practitioner' Tag*

Der ‚practitioner Tag‘ ist derzeit (kann auch erweitert werden) eines von drei Tags, die über die Testtreiber Schnittstelle vom jeweiligen Device abgefragt werden. Diese drei Tags sind in der pom.xml definiert (Erklärung zur pom.xml weiter oben) und sind folgende:

- client – Es handelt sich um einen User Client, der Nachrichten versenden darf
- orgAdmin – Es handelt sich um einen OrgAdmin Client, der auf das Organisationsverzeichnis im VZD zugreifen darf
- practitioner – Hinter diesem Device ist eine HBA hinterlegt, so dass der User auch auf das Personenverzeichnis im VZD zugreifen darf

Folgen wir nun unserem vorigen Beispiel und schauen auf die Tags, die einerseits vergeben und andererseits vom Device selbst ausgelesen wurden:

image::target_combine_items.png[]

Wir haben es an dieser Schnittstelle also mit einem User Client („client“) zu tun, der auch eine HBA hinterlegt hat („practitioner“), um z.B. Einträge im Personenverzeichnis des VDZ zu tätigen.

Somit ergeben sich als Verwendung dieses Devices nun zwei Möglichkeiten, die dann über die Filterung der Testdaten exakt zum Testfall passend erzeugt werden können:

- Wir können dieses Device als HBA-User nutzen mit allen Handlungsmöglichkeiten, für die eine HBA Authentifizierung notwendig ist
- Wir können dieses Device aber auch als Organisation-User nutzen, indem wir im Testfall z.B. keine Aktionen im Personenverzeichnis im VZD durchführen, also die HBA nicht nutzen.

*Das 'prefIOP' Tag*

Dieser Client ist als Preferred IOP (prefIOP) gekennzeichnet → Wird also in den IOP Tests bevorzugt genutzt. Dieser Tag kann frei vergeben und in der Filterung der Testdaten genutzt werden.

[TIP]
[black]#*_Zur Nutzung des Tags 'prefIOP' sollte immer ein Device gewählt werden, hinter dem eine HBA liegt. So ist sichergestellt, dass sowohl Tests im HBA Kontext und ohne diesen Kontext ausgeführt werden!_*#


[.text-right]
<<id0,Inhaltsverzeichnis>>

image::BP.png[float="left"]

=== 7. Berechtigungsprüfung
{empty} +


image::Konzept.png[float="left"]


==== 7.1 Berechtigungskonzept
{empty}  +

Berechtigungskonzept - Stufe 1

In der 1. Stufe MUSS geprüft werden, ob die in der Anfrage enthaltenen Matrix-Domains zugehörig zur
TI-Föderation sind. Ist dies der Fall, MUSS die Anfrage an den Matrix-Homeserver des
Einladenden weitergeleitet werden.
Ist dies nicht der Fall, MUSS die beabsichtigte Anfrage des Akteurs vom Messenger-Proxy des
Einladenden abgelehnt werden. Nach der Weiterleitung an den Matrix-Homeserver prüft dieser, ob der
eingeladene Akteur der gleichen Organisation angehört. Stellt der Matrix-Homeserver fest das der
eingeladene Akteur nicht zu seiner Domain gehört wird das Invite-Event an den Messenger-Proxy des
einzuladenden Akteurs weitergeleitet. Dieser prüft erneut die Zugehörigkeit zur TI-Föderation
(Stufe 1). Bei erfolgreicher Prüfung erfolgt dann die Weiterverarbeitung gemäß der Stufe 2.

Berechtigungskonzept - Stufe 2

In dieser Stufe prüft der Messenger-Proxy des Einzuladenden auf eine *vorliegende Freigabe*. Hierbei
handelt es sich um eine Lookup-Table, in der alle erlaubten Akteure hinterlegt sind, von denen man
eine Einladung in einen Chatraum akzeptiert. Ist ein Eintrag vom einladenden Akteur vorhanden, dann
MUSS die beabsichtigte Einladung des Akteurs zugelassen werden. Ist dies nicht der Fall, MUSS die
weitere Überprüfung gemäß der 3. Stufe erfolgen.

Berechtigungskonzept - Stufe 3

In der letzten Stufe erfolgt die Prüfung ausgehend von den Einträgen der beteiligten Akteure
im VZD-FHIR-Directory. Die Einladung MUSS zugelassen werden, wenn:

.. *die MXID des einzuladenden Akteurs im Organisationsverzeichnis hinterlegt und seine Sichtbarkeit
  in diesem Verzeichnis nicht eingeschränkt ist* oder

.. *der einladende sowie der einzuladende Akteur im Personenverzeichnis hinterlegt sind und der
  einzuladende Akteur seine Sichtbarkeit in diesem Verzeichnis nicht eingeschränkt hat*

Ist die Prüfung nicht erfolgreich, dann MUSS die beabsichtigte Einladung des Akteurs vom
Messenger-Proxy abgelehnt werden.

[.text-right]
<<id0,Inhaltsverzeichnis>>

image::Erfolgreich.png[float="left"]

[[id1,erfolgreiche]]
==== 7.2 Tags für die erfolgreichen Berechtigungsprüfungen
{empty}  +

*Teilnehmer "A" kann alle Teilnehmer "B" einladen wenn diese einen Eintrag für "A" in der Freigabeliste
erstellt hat.*

*Berechtigungsprüfung Stufe 2*

[cols='30%,30%,15%,15%']
|===
| *Teilnehmer A*  |*Teilnnehmer B*          | *Ergebnis* | *Tag*
| alle            | alle mit Freigabe für A | ok         | @BP_FL
|===

*Teilnehmer "A" lädt Teilnehmer "B" (ohne Freigabelisteneintrag) ein.*

*Berechtigungsprüfung Stufe 3a*

[cols='30%,30%,15%,15%']
|===
| *Teilnehmer A*           |*Teilnnehmer B*           | *Ergebnis* | *Tag*
| Personenverzeichnis      | Organisationsverzeichnis | ok         | @BP_P2O
| Organisationsverzeichnis | Organisationsverzeichnis | ok         | @BP_O2O
| ohne Eintrag             | Organisationsverzeichnis | ok         | @BP_N2O
|===

*Berechtigungsprüfung Stufe 3b*

[cols='30%,30%,15%,15%']
|===
| *Teilnehmer A*           |*Teilnnehmer B*           | *Ergebnis* | *Tag*
| Personenverzeichnis      | Personenverzeichnis      | ok         | @BP_P2P
|===

*Homeserver intern (beide Teinnehmer befinden sich auf dem selben Homeserver)*

[cols='30%,30%,15%,15%']
|===
| *Teilnehmer A*           |*Teilnnehmer B*           | *Ergebnis* | *Tag*
| Personenverzeichnis      | ohne Eintrag             | ok         | @BP_P2N_intern
| Organisationsverzeichnis | Personenverzeichnis      | ok         | @BP_O2P_intern
| Organisationsverzeichnis | ohne Eintrag             | ok         | @BP_O2N_intern
| ohne Eintrag             | Personenverzeichnis      | ok         | @BP_N2P_intern
|===
[.text-right]
<<id0,Inhaltsverzeichnis>>

image::Firewall.png[float="left"]

[[id2,nicht erfolgreiche]]
==== 7.3 Tags für die nicht erfolgreichen Berechtigungsprüfungen
{empty} +

*Teilnehmer "A" lädt Teilnehmer "B" aus einer anderen Organisation (ohne Freigabelisteneintrag) ein.*

*Berechtigungsprüfung nicht erfolgreich*
[cols='30%,30%,15%,15%']
|===
| *Teilnehmer A*           |*Teilnnehmer B*           | *Ergebnis* | *Tag*
| Personenverzeichnis      | ohne Eintrag             | abgelehnt  | @BP_P2N_extern
| Organisationsverzeichnis | Personenverzeichnis      | abgelehnt  | @BP_O2P_extern
| Organisationsverzeichnis | ohne Eintrag             | abgelehnt  | @BP_O2N_extern
| ohne Eintrag             | Personenverzeichnis      | abgelehnt  | @BP_N2P_extern
|===

[.text-right]
<<id0,Inhaltsverzeichnis>>

image::Tests.png[float="left"]

[[id8,Testfall Liste]]
=== 8. Testfall Liste
{empty} +

////

mit diesen grep Befehl kann eine neue/aktuelle Testfallliste erstellt werden

cd <git_home>/ti-m-testsuite/src/test/resources/templates/Zulassungstests/Testrun

grep Szenariogrundriss * |while read var; do   set -- $var ;   shift 2;   echo $*; done
bzw.
grep Szenariogrundriss * | sed 's/^[0-9]*_[A-Z,a-z,.,:, ,_,ß]*//g'

////


[[id81,Zurück]] *Abfragen der Geräte-Information aller Schnittstellen*
[cols='^6%,90%']
|===
|00.1 | Abfragen der Schnittstellen-Information durch HBA-User-Client
|00.2 | Abfragen der Schnittstellen-Information durch Organisations-User-Client
|00.3 | Abfragen der Schnittstellen-Information durch Org-Admin-Client
|00.4 | Abfragen der Geräte-Liste durch HBA-User-Client
|00.5 | Abfragen der Geräte-Liste durch Organisations-User-Client
|00.6 | Abfragen der Geräte-Liste durch Org-Admin-Client
|===

[.text-center]
<<id81,Zurück>>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
<<id8,Testfall Liste>>

[[id82,Zurück]] *AF_1005 Organisationsressourcen im Verzeichnisdienst hinzufügen*
[cols='^6%,90%']
|===
|03.1 | Organisationsressourcen im Verzeichnisdienst hinzufügen - Healthcare-Service durch Org-Admin anlegen
|03.2 | Organisationsressourcen im Verzeichnisdienst hinzufügen - Healthcare-Service durch Org-Admin anlegen und Endpoint ändern
|03.3 | Organisationsressourcen im Verzeichnisdienst hinzufügen - Healthcare-Service durch Org-Admin anlegen/ändern, Endpoint anlegen/ändern und löschen
|03.4 | Organisationsressourcen im Verzeichnisdienst hinzufügen - Healthcare-Service durch Org-Admin mit zwei Endpoints anlegen und löschen
|03.5 | Organisationsressourcen im Verzeichnisdienst hinzufügen - Nicht validen Healthcare-Service durch Org-Admin anlegen
|===

[.text-center]
<<id81,Zurück>>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
<<id8,Testfall Liste>>

[[id83,Zurück]] *AF_10057 Anmeldung eines Akteurs am Messenger-Service*
[cols=' ^6%,90%']
|===
|04.1 | Anmeldung eines Akteurs - Erfolgreiche Anmeldung eines Akteurs (HBA)
|04.2 | Anmeldung eines Akteurs - Erfolgreiche Anmeldung eines Akteurs (OrgUser)
|04.3 | Anmeldung eines Akteurs - Erfolgreiche Anmeldung eines Akteurs (OrgAdmin)
|===

[.text-center]
<<id82,Zurück>>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
<<id8,Testfall Liste>>

[[id84,Zurück]] *AF_10058 Akteur (User-HBA) im Verzeichnisdienst hinzufügen*
[cols='^6%,90%']
|===
|05.1 | Akteur im Verzeichnisdienst - Hinzufügen - HBA-User legt sich an und sucht seinen Eintrag
|05.2 | Akteur im Verzeichnisdienst - Hinzufügen - HBA-User legt sich an und sucht anderen Eintrag
|05.3 | Akteur im Verzeichnisdienst - Hinzufügen - HBA-User aus anderer Organisation sucht HBA-User Eintrag
|05.4 | Akteur im Verzeichnisdienst - Löschen - HBA-User löscht Eintrag
|05.5 | Akteur im Verzeichnisdienst - Löschen - HBA-User löscht Eintrag und ist nicht aufindbar für HBA-User anderer Organisation
|05.6 | Akteur im Verzeichnisdienst - Hinzufügen - Nicht erfolgreich ohne Authencitation im Verzeichnisdienst
|===

[.text-center]
<<id83,Zurück>>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
<<id8,Testfall Liste>>

[[id85,Zurück]] *AF_10104 Einladung von Akteuren innerhalb eines Messenger-Service*
[cols='^6%,90%']
|===
|07.1 | Einladung innerhalb einer Organisation - Einladung in Chat - Qualifizierte Suche (HBA-User an HBA-User)
|07.2 | Einladung innerhalb einer Organisation - Einladung in Chat - Teilqualifizierte Suche (HBA-User an HBA-User)
|07.3 | Einladung innerhalb einer Organisation - Einladung in Raum - Qualifizierte Suche (HBA-User an HBA-User)
|07.4 | Einladung innerhalb einer Organisation - Einladung in Raum - Teilqualifizierte Suche (HBA-User an HBA-User)
|07.5 | Einladung innerhalb einer Organisation - Einladung in Chat - HBA-User lädt Organisations-User ein
|07.6 | Einladung innerhalb einer Organisation - Einladung in Raum - Organisations-User lädt Organisations-User ein
|07.7 | Einladung innerhalb einer Organisation - Einladung in Chat - Organisations-User lädt HBA-User ein
|07.8 | Einladung innerhalb einer Organisation - Einladung in Chat - Ablehnung der Einladung (HBA-User an HBA-User)
|07.9 | Einladung innerhalb einer Organisation - Einladung in Raum - Ablehnung der Einladung (HBA-User an HBA-User)
|07.10| Einladung innerhalb einer Organisation - Einladung in Chat - Ablehnung der Einladung (Organisations-User an Organisations-User)
|07.11| Einladung innerhalb einer Organisation - Einladung in Raum - Ablehnung der Einladung (Organisations-User an Organisations-User)
|07.12| Einladung innerhalb einer Organisation - Einladung in Chat - Dritter Nutzer soll in Chat eingeladen werden (HBA)
|07.13| Einladung innerhalb einer Organisation - Einladung in Chat - Dritter Nutzer soll in Chat eingeladen werden (OrgUser)
|07.14| Einladung innerhalb einer Organisation - Im Verzeichnisdienst nicht registrierter Nutzer wird gesucht durch HBA-User
|07.15| Einladung innerhalb einer Organisation - Im Verzeichnisdienst nicht registrierter Nutzer wird gesucht durch Organisations-User
|07.16| Einladung innerhalb einer Organisation - Im Verzeichnisdienst nicht registrierter Nutzer wird angeschrieben durch HBA-User
|07.17| Einladung innerhalb einer Organisation - Im Verzeichnisdienst nicht registrierter Nutzer wird angeschrieben durch Organisations-User
|07.18| Einladung innerhalb einer Organisation - Einladung in Chat - HBA-User ohne Eintrag im Verzeichnisdienst versucht HBA-User einzuladen
|07.19| Einladung innerhalb einer Organisation - Einladung in Raum - HBA-User ohne Eintrag im Verzeichnisdienst versucht HBA-User einzuladen
|07.20| Einladung innerhalb einer Organisation - Einladung in Chat - Organisations-User ohne Eintrag im Verzeichnisdienst versucht Organisations-User einzuladen
|07.21| Einladung innerhalb einer Organisation - Einladung in Raum - Organisations-User ohne Eintrag im Verzeichnisdienst versucht Organisations-User einzuladen
|07.22| Einladung innerhalb einer Organisation - Einladung in Chat - Qualifizierte Suche auf dem Homeserver
|07.23| Einladung innerhalb einer Organisation - Einladung in Chat - Teilqualifizierte Suche auf dem Homeserver
|07.24| Einladung innerhalb einer Organisation - Einladung in Raum - Qualifizierte Suche  auf dem Homeserver
|07.25| Einladung innerhalb einer Organisation - Einladung in Raum - Teilqualifizierte Suche auf dem Homeserver
|===

[.text-center]
<<id84,Zurück>>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
<<id8,Testfall Liste>>

[[id86,Zurück]] *AF_10063 Austausch von Events innerhalb eines Messenger-Service*
[cols=' ^6%,90%']
|===
|08.1 | Events innerhalb einer Organisation - Chat - Test-Client "A" sendet und empfängt eine Nachricht
|08.2 | Events innerhalb einer Organisation - Raum - Test-Client "A" sendet eine Nachricht
|08.3 | Events innerhalb einer Organisation - Raum - Test-Client "B" sendet eine Nachricht
|08.4 | Events innerhalb einer Organisation - Chat - HBA-User sendet Organisations-User eine Nachricht
|08.5 | Events innerhalb einer Organisation - Raum - HBA-User sendet Organisations-User eine Nachricht
|08.6 | Events innerhalb einer Organisation - Chat - Organisations-User sendet Organisations-User eine Nachricht
|08.7 | Events innerhalb einer Organisation - Raum - Organisations-User sendet Organisations-User eine Nachricht
|08.8 | Events innerhalb einer Organisation - Chat - Organisations-User sendet HBA-User eine Nachricht
|08.9 | Events innerhalb einer Organisation - Raum - Organisations-User sendet HBA-User eine Nachricht
|08.10| Events innerhalb einer Organisation - Chat - HBA-User "B" löscht eine Nachricht
|08.11| Events innerhalb einer Organisation - Chat - Organisations-User "B" löscht eine Nachricht
|08.12| Events innerhalb einer Organisation - Raum - HBA-User "A" löscht eine Nachricht
|08.13| Events innerhalb einer Organisation - Raum - Organisations-User "A" löscht eine Nachricht
|08.14| Events innerhalb einer Organisation - Raum - HBA-User "A" sendet eine Nachricht an ausgeloggten Test-Client "B"
|08.15| Events innerhalb einer Organisation - Raum - Organisations-User "A" sendet eine Nachricht an ausgeloggten Test-Client "B"
|08.16| Events innerhalb einer Organisation - Raum - HBA-User "A" sendet ein Attachment
|08.17| Events innerhalb einer Organisation - Raum - Organisations-User "A" sendet ein Attachment
|08.18| Events innerhalb einer Organisation - Raum - HBA-User "B" sendet ein Attachment
|08.19| Events innerhalb einer Organisation - Raum - Organisations-User "B" sendet ein Attachment
|08.20| Events innerhalb einer Organisation - Chat - Eventaustausch auf dem HomeServer
|08.21| Events innerhalb einer Organisation - Raum - Eventaustausch auf dem HomeServer
|===

[.text-center]
<<id85,Zurück>>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
<<id8,Testfall Liste>>

[[id87,Zurück]] *AF_10061 Einladung von Akteuren anderer Messenger-Services*
[cols='^6%,90%']
|===
|09.1 | Einladung außerhalb einer Organisation - Einladung in Chat - Qualifizierte Suche (HBA-User an HBA-User)
|09.2 | Einladung außerhalb einer Organisation - Einladung in Chat - Teilqualifizierte Suche (HBA-User an HBA-User)
|09.3 | Einladung außerhalb einer Organisation - Einladung in Raum - Qualifizierte Suche (HBA-User an HBA-User)
|09.4 | Einladung außerhalb einer Organisation - Einladung in Raum - Teilqualifizierte Suche (HBA-User an HBA-User)
|09.5 | Einladung außerhalb einer Organisation - Einladung in Chat - HBA-User lädt Organisations-User ein
|09.6 | Einladung außerhalb einer Organisation - Einladung in Raum - Organisations-User lädt Organisations-User ein
|09.7 | Einladung außerhalb einer Organisation - Einladung in Chat - Organisations-User lädt HBA-User ein
|09.8 | Einladung außerhalb einer Organisation - Einladung in Chat - Ablehnung der Einladung (HBA-User an HBA-User)
|09.9 | Einladung außerhalb einer Organisation - Einladung in Raum - Ablehnung der Einladung (HBA-User an HBA-User)
|09.10| Einladung außerhalb einer Organisation - Einladung in Chat - Ablehnung der Einladung (Organisations-User an Organisations-User)
|09.11| Einladung außerhalb einer Organisation - Einladung in Raum - Ablehnung der Einladung (Organisations-User an Organisations-User)
|09.12| Einladung außerhalb einer Organisation - Einladung in Chat - Dritter Nutzer soll in Chat eingeladen werden (HBA)
|09.13| Einladung außerhalb einer Organisation - Einladung in Chat - Dritter Nutzer soll in Chat eingeladen werden (OrgUser)
|09.14| Einladung außerhalb einer Organisation - Im Verzeichnisdienst nicht registrierter Nutzer wird gesucht durch HBA-User
|09.15| Einladung außerhalb einer Organisation - Im Verzeichnisdienst nicht registrierter Nutzer wird gesucht durch Organisations-User
|09.16| Einladung außerhalb einer Organisation - Im Verzeichnisdienst nicht registrierter Nutzer wird angeschrieben durch HBA-User
|09.17| Einladung außerhalb einer Organisation - Im Verzeichnisdienst nicht registrierter Nutzer wird angeschrieben durch Organisations-User
|09.18| Einladung außerhalb einer Organisation - Einladung in Chat - HBA-User ohne Eintrag im Verzeichnisdienst versucht HBA-User einzuladen
|09.19| Einladung außerhalb einer Organisation - Einladung in Raum - HBA-User ohne Eintrag im Verzeichnisdienst versucht Organisations-User einzuladen
|09.20| Einladung außerhalb einer Organisation - Einladung in Chat - Organisations-User ohne Eintrag im Verzeichnisdienst versucht HBA-User einzuladen
|09.21| Einladung außerhalb einer Organisation - Einladung in Raum - Organisations-User ohne Eintrag im Verzeichnisdienst versucht Organisations-User einzuladen
|09.22| Einladung außerhalb einer Organisation - Negativ Suche - Qualifizierte Suche auf dem Homeserver
|===

[.text-center]
<<id86,Zurück>>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
<<id8,Testfall Liste>>

[[id88,Zurück]] *AF_10062 Austausch von Events zwischen anderen Messenger-Services*
[cols='^6%,90%']
|===
|10.1 | Events außerhalb einer Organisation - Chat - Test-Client "A" sendet und empängt eine Nachricht
|10.2 | Events außerhalb einer Organisation - Raum - Test-Client "A" sendet eine Nachricht
|10.3 | Events außerhalb einer Organisation - Raum - Test-Client "B" sendet eine Nachricht
|10.4 | Events außerhalb einer Organisation - Chat - HBA-User sendet Organisations-User eine Nachricht
|10.5 | Events außerhalb einer Organisation - Raum - HBA-User sendet Organisations-User eine Nachricht
|10.6 | Events außerhalb einer Organisation - Chat - Organisations-User sendet Organisations-User eine Nachricht
|10.7 | Events außerhalb einer Organisation - Raum - Organisations-User sendet Organisations-User eine Nachricht
|10.8 | Events außerhalb einer Organisation - Chat - Organisations-User sendet HBA-User eine Nachricht
|10.9 | Events außerhalb einer Organisation - Raum - Organisations-User sendet HBA-User eine Nachricht
|10.10| Events außerhalb einer Organisation - Chat - HBA-User "B" löscht eine Nachricht
|10.11| Events außerhalb einer Organisation - Chat - Organisations-User "B" löscht eine Nachricht
|10.12| Events außerhalb einer Organisation - Raum - HBA-User "A" löscht eine Nachricht
|10.13| Events außerhalb einer Organisation - Raum - Organisations-User "A" löscht eine Nachricht
|10.14| Events außerhalb einer Organisation - Raum - HBA-User "A" sendet eine Nachricht an ausgeloggten "B"
|10.15| Events außerhalb einer Organisation - Raum - Organisations-User "A" sendet eine Nachricht an ausgeloggten "B"
|10.16| Events außerhalb einer Organisation - Raum - HBA-User "B" sendet ein Attachment
|10.17| Events außerhalb einer Organisation - Raum - Organisations-User "B" sendet ein Attachment
|10.18| Events außerhalb einer Organisation - Raum - HBA-User "A" sendet ein Attachment
|10.19| Events außerhalb einer Organisation - Raum - Organisations-User "A" sendet ein Attachment
|===

[.text-center]
<<id87,Zurück>>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
<<id8,Testfall Liste>>

[[id89,Zurück]] *Einladung von Akteuren via Freigabeliste*
[cols='^6%,90%']
|===
|11.1 | Einladung via Freigabeliste außerhalb einer Oganisation - Raum - Beide User jeweils in Freigabeliste (HBA-User an HBA-User)
|11.2 | Einladung via Freigabeliste außerhalb einer Oganisation - Chat - Beide User jeweils in Freigabeliste (HBA-User an HBA-User)
|11.3 | Einladung via Freigabeliste außerhalb einer Oganisation - Chat - Nur ein User in Freigabeliste (Organisations-User an HBA-User)
|11.4 | Einladung via Freigabeliste außerhalb einer Oganisation - Raum - Nur ein User in Freigabeliste (HBA-User an HBA-User)
|11.5 | Einladung via Freigabeliste außerhalb einer Oganisation - Chat - Nur User in eigener Freigabeliste (HBA-User an HBA-User)
|===

[.text-center]
<<id88,Zurück>>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
<<id8,Testfall Liste>>

[[id810,Zurück]] *Gruppen Chats*
[cols='^6%,90%']
|===
|12.1 | Events außerhalb einer Organisation - Gruppenchat - Test-Client "A" sendet eine Nachricht (HBA-User)
|12.2 | Events außerhalb einer Organisation - Gruppenchat - Test-Client "E" sendet eine Nachricht (HBA-User)
|12.3 | Events außerhalb einer Organisation - Gruppenchat - Test-Client "F" sendet eine Nachricht (Organisations-User)
|12.4 | Events außerhalb einer Organisation - Gruppenchat - Test-Client "C" sendet eine Nachricht (HBA-User lädt Organisations-User ein)
|12.5 | Events innerhalb einer Organisation - Gruppenchat - Test-Client "A" sendet eine Nachricht (HBA-User)
|12.6 | Events innerhalb einer Organisation - Gruppenchat - Test-Client "C" sendet eine Nachricht (HBA-User)
|12.7 | Events innerhalb einer Organisation - Gruppenchat - Test-Client "B" sendet eine Nachricht (Organisations-User)
|12.8 | Events innerhalb einer Organisation - Gruppenchat - Test-Client "B" sendet eine Nachricht (HBA-User lädt Organisations-User ein)
|===

[.text-center]
<<id89,Zurück>>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
<<id8,Testfall Liste>>

[[id811,Zurück]] *Nutzung von mehreren Geräten*
[cols='^6%,90%']
|===
|13.1 | Events außerhalb einer Organisation - Chat - Test-Client "A" mit 2 Devices
|13.2 | Events außerhalb einer Organisation - Chat - Test-Client "A" mit 2 Devices
|13.3 | Events außerhalb einer Organisation - Chat - Test-Client "A" mit 2 Devices - Erhalt vorheriger Nachrichten
|13.4 | Events außerhalb einer Organisation - Chat - Test-Client "A" mit 2 Devices - Erhalt vorheriger Nachrichten
|13.5 | Events innerhalb einer Organisation - Chat - Test-Client "A" mit 2 Devices
|13.6 | Events innerhalb einer Organisation - Chat - Test-Client "A" mit 2 Devices
|13.7 | Events innerhalb einer Organisation - Chat - Test-Client "A" mit 2 Devices - Erhalt vorheriger Nachrichten
|13.8 | Events innerhalb einer Organisation - Chat - Test-Client "A" mit 2 Devices - Erhalt vorheriger Nachrichten
|===

[.text-center]
<<id810,Zurück>>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
<<id8,Testfall Liste>>

[.text-right]
<<id0,Inhaltsverzeichnis>>

image::Testrun.png[float="left"]
=== 9. Testausführung
{empty} +

*Die Testsiute wird mit maven gestartet werden:*

maven clean verify

*Es können auch vordefinierte Profile verwendet werden:*

[cols='1,3']
|===
| ci-pipeline | jeder Testfall wird in der Single Mock Umgebung nur einmal ausgeführt
| newonly     | der Testschwerpunkt liegt auf neuen Elementen
| oneonly     | jeder Testfall wird nur einmal ausgeführt
| usetags     | es werden nur bestimmte Tags ausgeführt, default @Ctl:UseCase
|===

*Im Terminal kann dieses Tag und Konfigfiles überschrieben werden:*

mvn clean verify -Dcucumber.filter.tags=@FeatureFile_04 -Poneonly,usetags

mvn clean verify -Dcucumber.filter.tags=@TCID:TIM_11_AF_401 -Pusetags

mvn clean verify -Dtiger.config.file=tiger-dev.yml -Pusetags

*Im Terminal können Timeout und PollIntervall eingestellt werden*

mvn clean verify -Dtimeout=_<Timeout in Sekunden>_ -DpollInterval=_<PollIntervall in Sekunden>_

Default:

* Timeout = 10 Sekunden
* PollInterval = 1 Sekunde

[WARNING]
Das Timeout muss immer größer als das PollInterval sein!

[.text-right]
<<id0,Inhaltsverzeichnis>>

image::Tests.png[float="left"]
=== 10. Testfall Beschreibungen
{empty} +

Die Beschreibung der Testfälle befindet sich direkt in den Feature Files. Durch die Verwendung von Gherkin sind die einzelnen Teststeps
selbst erklärend.

[.text-right]
<<id0,Inhaltsverzeichnis>>
